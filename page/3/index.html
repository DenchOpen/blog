<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://denchopen.github.io/blog').hostname,
    root: '/blog/',
    scheme: 'Gemini',
    version: '7.7.1',
    exturl: false,
    sidebar: {"enable":true,"position":"left","width":280,"display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="Love &amp; Peace">
<meta property="og:type" content="website">
<meta property="og:title" content="个人小站">
<meta property="og:url" content="https://denchopen.github.io/blog/page/3/index.html">
<meta property="og:site_name" content="个人小站">
<meta property="og:description" content="Love &amp; Peace">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Dench">
<meta property="article:tag" content="Android">
<meta property="article:tag" content=" hexo">
<meta property="article:tag" content=" NexT">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://denchopen.github.io/blog/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>个人小站</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/blog/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">个人小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Dench's</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/DenchOpen" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://denchopen.github.io/blog/2022/02/16/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B8%83%E5%B1%80-SpannableString%E4%B9%8B%E6%98%BE%E7%A4%BA%E6%9F%A5%E7%9C%8B%E5%85%A8%E6%96%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.png">
      <meta itemprop="name" content="Dench">
      <meta itemprop="description" content="Love & Peace">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人小站">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2022/02/16/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B8%83%E5%B1%80-SpannableString%E4%B9%8B%E6%98%BE%E7%A4%BA%E6%9F%A5%E7%9C%8B%E5%85%A8%E6%96%87/" class="post-title-link" itemprop="url">SpannableString 之显示查看全文</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-02-16 21:03:13 / 修改时间：23:49:13" itemprop="dateCreated datePublished" datetime="2022-02-16T21:03:13+08:00">2022-02-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="SpannableString-之显示查看全文"><a href="#SpannableString-之显示查看全文" class="headerlink" title="SpannableString 之显示查看全文"></a>SpannableString 之显示查看全文</h2><p>显示内容超出规定的行数之后，显示 <code>展开</code> 和 <code>收起</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Color;</span><br><span class="line"><span class="keyword">import</span> android.os.Build;</span><br><span class="line"><span class="keyword">import</span> android.text.Layout;</span><br><span class="line"><span class="keyword">import</span> android.text.SpannableString;</span><br><span class="line"><span class="keyword">import</span> android.text.SpannableStringBuilder;</span><br><span class="line"><span class="keyword">import</span> android.text.Spanned;</span><br><span class="line"><span class="keyword">import</span> android.text.StaticLayout;</span><br><span class="line"><span class="keyword">import</span> android.text.TextPaint;</span><br><span class="line"><span class="keyword">import</span> android.text.TextUtils;</span><br><span class="line"><span class="keyword">import</span> android.text.style.AlignmentSpan;</span><br><span class="line"><span class="keyword">import</span> android.text.style.ClickableSpan;</span><br><span class="line"><span class="keyword">import</span> android.text.style.StyleSpan;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.animation.Animation;</span><br><span class="line"><span class="keyword">import</span> android.view.animation.Transformation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.annotation.ColorInt;</span><br><span class="line"><span class="keyword">import</span> androidx.annotation.NonNull;</span><br><span class="line"><span class="keyword">import</span> androidx.annotation.Nullable;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.widget.AppCompatTextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description : 显示展开和收起</span></span><br><span class="line"><span class="comment"> * PackageName : com.mrtrying.widget</span></span><br><span class="line"><span class="comment"> * Created by mrtrying on 2019/4/17 17:21.</span></span><br><span class="line"><span class="comment"> * e_mail : ztanzeyu@gmail.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExpandableTextView</span> <span class="keyword">extends</span> <span class="title">AppCompatTextView</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = ExpandableTextView<span class="class">.<span class="keyword">class</span>.<span class="title">getSimpleName</span>()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ELLIPSIS_STRING = <span class="keyword">new</span> String(<span class="keyword">new</span> <span class="keyword">char</span>[]&#123;<span class="string">'\u2026'</span>&#125;);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_OPEN_SUFFIX = <span class="string">" 展开"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_CLOSE_SUFFIX = <span class="string">" 收起"</span>;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">boolean</span> animating = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">boolean</span> isClosed = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mMaxLines = getMaxLines();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> initWidth = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> CharSequence originalText;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SpannableStringBuilder mOpenSpannableStr, mCloseSpannableStr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> hasAnimation = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> Animation mOpenAnim, mCloseAnim;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mOpenHeight, mCLoseHeight;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mExpandable;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mCloseInNewLine;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> SpannableString mOpenSuffixSpan, mCloseSuffixSpan;</span><br><span class="line">    <span class="keyword">private</span> String mOpenSuffixStr = DEFAULT_OPEN_SUFFIX;</span><br><span class="line">    <span class="keyword">private</span> String mCloseSuffixStr = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mOpenSuffixColor, mCloseSuffixColor;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mNormalColor = Color.parseColor(<span class="string">"#FF222222"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> View.OnClickListener mOnClickListener;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CharSequenceToSpannableHandler mCharSequenceToSpannableHandler;</span><br><span class="line">    <span class="keyword">private</span> IOnOpenSuffixSpanListener onOpenSuffixSpanListener;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ExpandableTextView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">        initialize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ExpandableTextView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">        initialize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ExpandableTextView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        initialize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mOpenSuffixColor = mCloseSuffixColor = Color.parseColor(<span class="string">"#FF0091FF"</span>);</span><br><span class="line">        setMovementMethod(CustomLinkMovementMethod.getInstance());</span><br><span class="line"><span class="comment">//        setIncludeFontPadding(false);</span></span><br><span class="line">        updateOpenSuffixSpan();</span><br><span class="line">        updateCloseSuffixSpan();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasOverlappingRendering</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOriginalText</span><span class="params">(CharSequence originalText)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.originalText = originalText;</span><br><span class="line">        mExpandable = <span class="keyword">false</span>;</span><br><span class="line">        mCloseSpannableStr = <span class="keyword">new</span> SpannableStringBuilder();</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> maxLines = mMaxLines;</span><br><span class="line">        SpannableStringBuilder tempText = charSequenceToSpannable(originalText);</span><br><span class="line">        mOpenSpannableStr = charSequenceToSpannable(originalText);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (maxLines != -<span class="number">1</span>) &#123;</span><br><span class="line">            Layout layout = createStaticLayout(tempText);</span><br><span class="line">            mExpandable = layout.getLineCount() &gt; maxLines;</span><br><span class="line">            <span class="keyword">if</span> (mExpandable) &#123;</span><br><span class="line">                <span class="comment">//拼接展开内容</span></span><br><span class="line">                <span class="keyword">if</span> (mCloseInNewLine) &#123;</span><br><span class="line">                    mOpenSpannableStr.append(<span class="string">"\n"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (mCloseSuffixSpan != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    mOpenSpannableStr.append(mCloseSuffixSpan);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//计算原文截取位置</span></span><br><span class="line">                <span class="keyword">int</span> endPos = layout.getLineEnd(maxLines - <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span> (originalText.length() &lt;= endPos) &#123;</span><br><span class="line">                    mCloseSpannableStr = charSequenceToSpannable(originalText);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    mCloseSpannableStr = charSequenceToSpannable(originalText.subSequence(<span class="number">0</span>, endPos));</span><br><span class="line">                &#125;</span><br><span class="line">                SpannableStringBuilder tempText2 = charSequenceToSpannable(mCloseSpannableStr).append(ELLIPSIS_STRING);</span><br><span class="line">                <span class="keyword">if</span> (mOpenSuffixSpan != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    tempText2.append(mOpenSuffixSpan);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//循环判断，收起内容添加展开后缀后的内容</span></span><br><span class="line">                Layout tempLayout = createStaticLayout(tempText2);</span><br><span class="line">                <span class="keyword">while</span> (tempLayout.getLineCount() &gt; maxLines) &#123;</span><br><span class="line">                    <span class="keyword">int</span> lastSpace = mCloseSpannableStr.length() - <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">if</span> (lastSpace == -<span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (originalText.length() &lt;= lastSpace) &#123;</span><br><span class="line">                        mCloseSpannableStr = charSequenceToSpannable(originalText);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        mCloseSpannableStr = charSequenceToSpannable(originalText.subSequence(<span class="number">0</span>, lastSpace));</span><br><span class="line">                    &#125;</span><br><span class="line">                    tempText2 = charSequenceToSpannable(mCloseSpannableStr).append(ELLIPSIS_STRING);</span><br><span class="line">                    <span class="keyword">if</span> (mOpenSuffixSpan != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        tempText2.append(mOpenSuffixSpan);</span><br><span class="line">                    &#125;</span><br><span class="line">                    tempLayout = createStaticLayout(tempText2);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">int</span> lastSpace = mCloseSpannableStr.length();</span><br><span class="line"><span class="comment">//                        - mOpenSuffixSpan.length();</span></span><br><span class="line"><span class="comment">//                if(lastSpace &gt;= 0 &amp;&amp; originalText.length() &gt; lastSpace)&#123;</span></span><br><span class="line"><span class="comment">//                    CharSequence redundantChar = originalText.subSequence(lastSpace, lastSpace + mOpenSuffixSpan.length());</span></span><br><span class="line"><span class="comment">//                    int offset = hasEnCharCount(redundantChar) - hasEnCharCount(mOpenSuffixSpan) + 1;</span></span><br><span class="line"><span class="comment">//                    lastSpace = offset &lt;= 0 ? lastSpace : lastSpace - offset;</span></span><br><span class="line"><span class="comment">//                    mCloseSpannableStr = charSequenceToSpannable(originalText.subSequence(0, lastSpace));</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line">                <span class="comment">//计算收起的文本高度</span></span><br><span class="line">                mCLoseHeight = tempLayout.getHeight() + getPaddingTop() + getPaddingBottom();</span><br><span class="line"><span class="comment">//                mCloseSpannableStr.setSpan(new ClickableSpan() &#123;</span></span><br><span class="line"><span class="comment">//                    @Override</span></span><br><span class="line"><span class="comment">//                    public void onClick(@NonNull View widget) &#123;</span></span><br><span class="line"><span class="comment">//                        if (mOnClickListener != null) &#123;</span></span><br><span class="line"><span class="comment">//                            mOnClickListener.onClick(widget);</span></span><br><span class="line"><span class="comment">//                        &#125;</span></span><br><span class="line"><span class="comment">//                    &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//                    @Override</span></span><br><span class="line"><span class="comment">//                    public void updateDrawState(@NonNull TextPaint ds) &#123;</span></span><br><span class="line"><span class="comment">//                        super.updateDrawState(ds);</span></span><br><span class="line"><span class="comment">//                        ds.setColor(mNormalColor);</span></span><br><span class="line"><span class="comment">//                        ds.setUnderlineText(false);</span></span><br><span class="line"><span class="comment">//                    &#125;</span></span><br><span class="line"><span class="comment">//                &#125;, 0, length, Spanned.SPAN_INCLUSIVE_INCLUSIVE);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        isClosed = mExpandable;</span><br><span class="line">        <span class="keyword">if</span> (mExpandable) &#123;</span><br><span class="line"><span class="comment">//            mCloseSpannableStr.setSpan(new ClickableSpan() &#123;</span></span><br><span class="line"><span class="comment">//                @Override</span></span><br><span class="line"><span class="comment">//                public void onClick(@NonNull View widget) &#123;</span></span><br><span class="line"><span class="comment">//                    if(listener!=null)&#123;</span></span><br><span class="line"><span class="comment">//                        listener.onClick(widget);</span></span><br><span class="line"><span class="comment">//                    &#125;</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//                @Override</span></span><br><span class="line"><span class="comment">//                public void updateDrawState(@NonNull TextPaint ds) &#123;</span></span><br><span class="line"><span class="comment">//                    super.updateDrawState(ds);</span></span><br><span class="line"><span class="comment">//                    ds.setColor(mNormalColor);</span></span><br><span class="line"><span class="comment">//                    ds.setUnderlineText(false);</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//            &#125;, 0, mCloseSpannableStr.length(), Spanned.SPAN_INCLUSIVE_INCLUSIVE);</span></span><br><span class="line">            mCloseSpannableStr.append(ELLIPSIS_STRING);</span><br><span class="line">            <span class="keyword">if</span> (mOpenSuffixSpan != <span class="keyword">null</span>) &#123;</span><br><span class="line">                mCloseSpannableStr.append(mOpenSuffixSpan);</span><br><span class="line">            &#125;</span><br><span class="line">            setMovementMethod(CustomLinkMovementMethod.getInstance());</span><br><span class="line">            setClickable(<span class="keyword">false</span>);</span><br><span class="line">            setLongClickable(<span class="keyword">false</span>);</span><br><span class="line">            setText(mCloseSpannableStr);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//            mOpenSpannableStr.setSpan(new ClickableSpan() &#123;</span></span><br><span class="line"><span class="comment">//                @Override</span></span><br><span class="line"><span class="comment">//                public void onClick(@NonNull View widget) &#123;</span></span><br><span class="line"><span class="comment">//                    if (mOnClickListener != null) &#123;</span></span><br><span class="line"><span class="comment">//                        mOnClickListener.onClick(widget);</span></span><br><span class="line"><span class="comment">//                    &#125;</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//                @Override</span></span><br><span class="line"><span class="comment">//                public void updateDrawState(@NonNull TextPaint ds) &#123;</span></span><br><span class="line"><span class="comment">//                    super.updateDrawState(ds);</span></span><br><span class="line"><span class="comment">//                    ds.setColor(mNormalColor);</span></span><br><span class="line"><span class="comment">//                    ds.setUnderlineText(false);</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//            &#125;, 0, mOpenSpannableStr.length(), Spanned.SPAN_INCLUSIVE_INCLUSIVE);</span></span><br><span class="line">            setText(mOpenSpannableStr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">hasEnCharCount</span><span class="params">(CharSequence str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (!TextUtils.isEmpty(str)) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; str.length(); i++) &#123;</span><br><span class="line">                <span class="keyword">char</span> c = str.charAt(i);</span><br><span class="line">                <span class="keyword">if</span> (c &gt;= <span class="string">' '</span> &amp;&amp; c &lt;= <span class="string">'~'</span>) &#123;</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">switchOpenClose</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mExpandable) &#123;</span><br><span class="line">            isClosed = !isClosed;</span><br><span class="line">            <span class="keyword">if</span> (isClosed) &#123;</span><br><span class="line">                close();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                open();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置是否有动画</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hasAnimation</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHasAnimation</span><span class="params">(<span class="keyword">boolean</span> hasAnimation)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.hasAnimation = hasAnimation;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 展开</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (hasAnimation) &#123;</span><br><span class="line">            Layout layout = createStaticLayout(mOpenSpannableStr);</span><br><span class="line">            mOpenHeight = layout.getHeight() + getPaddingTop() + getPaddingBottom();</span><br><span class="line">            executeOpenAnim();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ExpandableTextView.<span class="keyword">super</span>.setMaxLines(Integer.MAX_VALUE);</span><br><span class="line">            setText(mOpenSpannableStr);</span><br><span class="line">            <span class="keyword">if</span> (mOpenCloseCallback != <span class="keyword">null</span>) &#123;</span><br><span class="line">                mOpenCloseCallback.onOpen();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 收起</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (hasAnimation) &#123;</span><br><span class="line">            executeCloseAnim();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ExpandableTextView.<span class="keyword">super</span>.setMaxLines(mMaxLines);</span><br><span class="line">            setText(mCloseSpannableStr);</span><br><span class="line">            <span class="keyword">if</span> (mOpenCloseCallback != <span class="keyword">null</span>) &#123;</span><br><span class="line">                mOpenCloseCallback.onClose();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行展开动画</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">executeOpenAnim</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建展开动画</span></span><br><span class="line">        <span class="keyword">if</span> (mOpenAnim == <span class="keyword">null</span>) &#123;</span><br><span class="line">            mOpenAnim = <span class="keyword">new</span> ExpandCollapseAnimation(<span class="keyword">this</span>, mCLoseHeight, mOpenHeight);</span><br><span class="line">            mOpenAnim.setFillAfter(<span class="keyword">true</span>);</span><br><span class="line">            mOpenAnim.setAnimationListener(<span class="keyword">new</span> Animation.AnimationListener() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Animation animation)</span> </span>&#123;</span><br><span class="line">                    ExpandableTextView.<span class="keyword">super</span>.setMaxLines(Integer.MAX_VALUE);</span><br><span class="line">                    setText(mOpenSpannableStr);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animation animation)</span> </span>&#123;</span><br><span class="line">                    <span class="comment">//  动画结束后textview设置展开的状态</span></span><br><span class="line">                    getLayoutParams().height = mOpenHeight;</span><br><span class="line">                    requestLayout();</span><br><span class="line">                    animating = <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationRepeat</span><span class="params">(Animation animation)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (animating) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        animating = <span class="keyword">true</span>;</span><br><span class="line">        clearAnimation();</span><br><span class="line">        <span class="comment">//  执行动画</span></span><br><span class="line">        startAnimation(mOpenAnim);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 执行收起动画</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">executeCloseAnim</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建收起动画</span></span><br><span class="line">        <span class="keyword">if</span> (mCloseAnim == <span class="keyword">null</span>) &#123;</span><br><span class="line">            mCloseAnim = <span class="keyword">new</span> ExpandCollapseAnimation(<span class="keyword">this</span>, mOpenHeight, mCLoseHeight);</span><br><span class="line">            mCloseAnim.setFillAfter(<span class="keyword">true</span>);</span><br><span class="line">            mCloseAnim.setAnimationListener(<span class="keyword">new</span> Animation.AnimationListener() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Animation animation)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animation animation)</span> </span>&#123;</span><br><span class="line">                    animating = <span class="keyword">false</span>;</span><br><span class="line">                    ExpandableTextView.<span class="keyword">super</span>.setMaxLines(mMaxLines);</span><br><span class="line">                    setText(mCloseSpannableStr);</span><br><span class="line">                    getLayoutParams().height = mCLoseHeight;</span><br><span class="line">                    requestLayout();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationRepeat</span><span class="params">(Animation animation)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (animating) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        animating = <span class="keyword">true</span>;</span><br><span class="line">        clearAnimation();</span><br><span class="line">        <span class="comment">//  执行动画</span></span><br><span class="line">        startAnimation(mCloseAnim);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> spannable</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Layout <span class="title">createStaticLayout</span><span class="params">(SpannableStringBuilder spannable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> contentWidth = initWidth - getPaddingLeft() - getPaddingRight();</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) &#123;</span><br><span class="line">            StaticLayout.Builder builder = StaticLayout.Builder.obtain(spannable, <span class="number">0</span>, spannable.length(), getPaint(), contentWidth);</span><br><span class="line">            builder.setAlignment(Layout.Alignment.ALIGN_NORMAL);</span><br><span class="line">            builder.setIncludePad(getIncludeFontPadding());</span><br><span class="line">            builder.setLineSpacing(getLineSpacingExtra(), getLineSpacingMultiplier());</span><br><span class="line">            <span class="keyword">return</span> builder.build();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.JELLY_BEAN) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> StaticLayout(spannable, getPaint(), contentWidth, Layout.Alignment.ALIGN_NORMAL,</span><br><span class="line">                    getLineSpacingMultiplier(), getLineSpacingExtra(), getIncludeFontPadding());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> StaticLayout(spannable, getPaint(), contentWidth, Layout.Alignment.ALIGN_NORMAL,</span><br><span class="line">                    getFloatField(<span class="string">"mSpacingMult"</span>, <span class="number">1f</span>), getFloatField(<span class="string">"mSpacingAdd"</span>, <span class="number">0f</span>), getIncludeFontPadding());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">float</span> <span class="title">getFloatField</span><span class="params">(String fieldName, <span class="keyword">float</span> defaultValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">float</span> value = defaultValue;</span><br><span class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(fieldName)) &#123;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取该类的所有属性值域</span></span><br><span class="line">            Field[] fields = <span class="keyword">this</span>.getClass().getDeclaredFields();</span><br><span class="line">            <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">                <span class="keyword">if</span> (TextUtils.equals(fieldName, field.getName())) &#123;</span><br><span class="line">                    value = field.getFloat(<span class="keyword">this</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> charSequence</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> SpannableStringBuilder <span class="title">charSequenceToSpannable</span><span class="params">(@NonNull CharSequence charSequence)</span> </span>&#123;</span><br><span class="line">        SpannableStringBuilder spannableStringBuilder = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (mCharSequenceToSpannableHandler != <span class="keyword">null</span>) &#123;</span><br><span class="line">            spannableStringBuilder = mCharSequenceToSpannableHandler.charSequenceToSpannable(charSequence);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (spannableStringBuilder == <span class="keyword">null</span>) &#123;</span><br><span class="line">            spannableStringBuilder = <span class="keyword">new</span> SpannableStringBuilder(charSequence);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> spannableStringBuilder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化TextView的可展示宽度</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> width</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initWidth</span><span class="params">(<span class="keyword">int</span> width)</span> </span>&#123;</span><br><span class="line">        initWidth = width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMaxLines</span><span class="params">(<span class="keyword">int</span> maxLines)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mMaxLines = maxLines;</span><br><span class="line">        <span class="keyword">super</span>.setMaxLines(maxLines);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置展开后缀text</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> openSuffix</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOpenSuffix</span><span class="params">(String openSuffix, IOnOpenSuffixSpanListener onOpenSuffixSpanListener)</span> </span>&#123;</span><br><span class="line">        mOpenSuffixStr = openSuffix;</span><br><span class="line">        <span class="keyword">this</span>.onOpenSuffixSpanListener = onOpenSuffixSpanListener;</span><br><span class="line">        updateOpenSuffixSpan();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNewOpenSuffix</span><span class="params">(String openSuffix, IOnOpenSuffixSpanListener onOpenSuffixSpanListener)</span> </span>&#123;</span><br><span class="line">        mOpenSuffixStr = openSuffix;</span><br><span class="line">        <span class="keyword">this</span>.onOpenSuffixSpanListener = onOpenSuffixSpanListener;</span><br><span class="line">        updateNewOpenSuffixSpan();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置展开后缀文本颜色</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> openSuffixColor</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOpenSuffixColor</span><span class="params">(@ColorInt <span class="keyword">int</span> openSuffixColor)</span> </span>&#123;</span><br><span class="line">        mOpenSuffixColor = openSuffixColor;</span><br><span class="line">        updateOpenSuffixSpan();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置收起后缀text</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> closeSuffix</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCloseSuffix</span><span class="params">(String closeSuffix)</span> </span>&#123;</span><br><span class="line">        mCloseSuffixStr = closeSuffix;</span><br><span class="line">        updateCloseSuffixSpan();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置收起后缀文本颜色</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> closeSuffixColor</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCloseSuffixColor</span><span class="params">(@ColorInt <span class="keyword">int</span> closeSuffixColor)</span> </span>&#123;</span><br><span class="line">        mCloseSuffixColor = closeSuffixColor;</span><br><span class="line">        updateCloseSuffixSpan();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 收起后缀是否另起一行</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> closeInNewLine</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCloseInNewLine</span><span class="params">(<span class="keyword">boolean</span> closeInNewLine)</span> </span>&#123;</span><br><span class="line">        mCloseInNewLine = closeInNewLine;</span><br><span class="line">        updateCloseSuffixSpan();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IOnOpenSuffixSpanListener</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新展开后缀Spannable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateOpenSuffixSpan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(mOpenSuffixStr)) &#123;</span><br><span class="line">            mOpenSuffixSpan = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        mOpenSuffixSpan = <span class="keyword">new</span> SpannableString(mOpenSuffixStr);</span><br><span class="line"></span><br><span class="line">        mOpenSuffixSpan.setSpan(<span class="keyword">new</span> ClickableSpan() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(@NonNull View widget)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (onOpenSuffixSpanListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    onOpenSuffixSpanListener.onClick();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    switchOpenClose();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateDrawState</span><span class="params">(@NonNull TextPaint ds)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.updateDrawState(ds);</span><br><span class="line">                ds.setColor(mOpenSuffixColor);</span><br><span class="line">                ds.setUnderlineText(<span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">0</span>, mOpenSuffixStr.length(), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateNewOpenSuffixSpan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(mOpenSuffixStr)) &#123;</span><br><span class="line">            mOpenSuffixSpan = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        mOpenSuffixSpan = <span class="keyword">new</span> SpannableString(mOpenSuffixStr);</span><br><span class="line"></span><br><span class="line">        mOpenSuffixSpan.setSpan(<span class="keyword">new</span> ClickableSpan() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(@NonNull View widget)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (onOpenSuffixSpanListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    onOpenSuffixSpanListener.onClick();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    switchOpenClose();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateDrawState</span><span class="params">(@NonNull TextPaint ds)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.updateDrawState(ds);</span><br><span class="line">                ds.setColor(mOpenSuffixColor);</span><br><span class="line">                ds.setUnderlineText(<span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">0</span>, mOpenSuffixStr.length(), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新收起后缀Spannable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateCloseSuffixSpan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(mCloseSuffixStr)) &#123;</span><br><span class="line">            mCloseSuffixSpan = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        mCloseSuffixSpan = <span class="keyword">new</span> SpannableString(mCloseSuffixStr);</span><br><span class="line">        mCloseSuffixSpan.setSpan(<span class="keyword">new</span> StyleSpan(android.graphics.Typeface.BOLD), <span class="number">0</span>, mCloseSuffixStr.length(), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line">        <span class="keyword">if</span> (mCloseInNewLine) &#123;</span><br><span class="line">            AlignmentSpan alignmentSpan = <span class="keyword">new</span> AlignmentSpan.Standard(Layout.Alignment.ALIGN_OPPOSITE);</span><br><span class="line">            mCloseSuffixSpan.setSpan(alignmentSpan, <span class="number">0</span>, <span class="number">1</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line">        &#125;</span><br><span class="line">        mCloseSuffixSpan.setSpan(<span class="keyword">new</span> ClickableSpan() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(@NonNull View widget)</span> </span>&#123;</span><br><span class="line">                switchOpenClose();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateDrawState</span><span class="params">(@NonNull TextPaint ds)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.updateDrawState(ds);</span><br><span class="line">                ds.setColor(mCloseSuffixColor);</span><br><span class="line">                ds.setUnderlineText(<span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">1</span>, mCloseSuffixStr.length(), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContentClickListener</span><span class="params">(View.OnClickListener onClickListener)</span> </span>&#123;</span><br><span class="line">        mOnClickListener = onClickListener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> OpenAndCloseCallback mOpenCloseCallback;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOpenAndCloseCallback</span><span class="params">(OpenAndCloseCallback callback)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mOpenCloseCallback = callback;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OpenAndCloseCallback</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onOpen</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onClose</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置文本内容处理</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCharSequenceToSpannableHandler</span><span class="params">(CharSequenceToSpannableHandler handler)</span> </span>&#123;</span><br><span class="line">        mCharSequenceToSpannableHandler = handler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CharSequenceToSpannableHandler</span> </span>&#123;</span><br><span class="line">        <span class="meta">@NonNull</span></span><br><span class="line">        <span class="function">SpannableStringBuilder <span class="title">charSequenceToSpannable</span><span class="params">(CharSequence charSequence)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ExpandCollapseAnimation</span> <span class="keyword">extends</span> <span class="title">Animation</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> View mTargetView;<span class="comment">//动画执行view</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> mStartHeight;<span class="comment">//动画执行的开始高度</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> mEndHeight;<span class="comment">//动画结束后的高度</span></span><br><span class="line"></span><br><span class="line">        ExpandCollapseAnimation(View target, <span class="keyword">int</span> startHeight, <span class="keyword">int</span> endHeight) &#123;</span><br><span class="line">            mTargetView = target;</span><br><span class="line">            mStartHeight = startHeight;</span><br><span class="line">            mEndHeight = endHeight;</span><br><span class="line">            setDuration(<span class="number">400</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">applyTransformation</span><span class="params">(<span class="keyword">float</span> interpolatedTime, Transformation t)</span> </span>&#123;</span><br><span class="line">            mTargetView.setScrollY(<span class="number">0</span>);</span><br><span class="line">            <span class="comment">//计算出每次应该显示的高度,改变执行view的高度，实现动画</span></span><br><span class="line">            mTargetView.getLayoutParams().height = (<span class="keyword">int</span>) ((mEndHeight - mStartHeight) * interpolatedTime + mStartHeight);</span><br><span class="line">            mTargetView.requestLayout();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>控件使用方式</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> tvContent = holder.getView&lt;ExpandableTextView&gt;(R.id.tv_content)</span><br><span class="line">tvContent.movementMethod = LinkMovementMethod.getInstance()</span><br><span class="line">tvContent.isClickable = <span class="literal">false</span></span><br><span class="line">tvContent.isLongClickable = <span class="literal">false</span></span><br><span class="line"><span class="keyword">val</span> builder = SpannableStringBuilder()</span><br><span class="line"><span class="keyword">if</span> (item.spoiler &amp;&amp; spoilerEnable) builder.append(<span class="string">"        "</span>)</span><br><span class="line"><span class="keyword">if</span> (item.talkList != <span class="literal">null</span> &amp;&amp; item.talkList.size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> talk = item.talkList[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">val</span> startIndex = builder.length</span><br><span class="line">    builder.append(<span class="string">"#"</span>)</span><br><span class="line">    builder.append(talk.name)</span><br><span class="line">    builder.append(<span class="string">" "</span>)</span><br><span class="line">    <span class="keyword">val</span> clickableSpan = <span class="keyword">object</span> : ClickableSpan() &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onClick</span><span class="params">(view: <span class="type">View</span>)</span></span> &#123;</span><br><span class="line">            talkClickListener?.invoke(item, holder.adapterPosition)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">updateDrawState</span><span class="params">(ds: <span class="type">TextPaint</span>)</span></span> &#123;</span><br><span class="line">            ds.color =</span><br><span class="line">                <span class="keyword">if</span> (talk.enable) Color.parseColor(<span class="string">"#1890FF"</span>)</span><br><span class="line">                <span class="keyword">else</span> Color.parseColor(<span class="string">"#85888F"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    builder.setSpan(</span><br><span class="line">        clickableSpan,</span><br><span class="line">        startIndex,</span><br><span class="line">        builder.length,</span><br><span class="line">        Spanned.SPAN_EXCLUSIVE_EXCLUSIVE</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line">builder.append(it)</span><br><span class="line">tvContent.initWidth(UiUtils.getScreenWidth() - UiUtils.dip2px(<span class="number">16</span> * <span class="number">2</span> + <span class="number">36</span> + <span class="number">9</span>))</span><br><span class="line">tvContent.setOpenSuffix(<span class="string">"查看全文"</span>) &#123;</span><br><span class="line">    listener.invoke(item, <span class="literal">null</span>)</span><br><span class="line">&#125;</span><br><span class="line">tvContent.setOriginalText(builder)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://denchopen.github.io/blog/2022/01/07/%E5%B7%A5%E5%85%B7%E7%B1%BB-%E8%87%AA%E5%90%AF%E5%8A%A8%E8%AE%BE%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.png">
      <meta itemprop="name" content="Dench">
      <meta itemprop="description" content="Love & Peace">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人小站">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2022/01/07/%E5%B7%A5%E5%85%B7%E7%B1%BB-%E8%87%AA%E5%90%AF%E5%8A%A8%E8%AE%BE%E7%BD%AE/" class="post-title-link" itemprop="url">SettingsHelper</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-07 17:29:00" itemprop="dateCreated datePublished" datetime="2022-01-07T17:29:00+08:00">2022-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-16 02:05:38" itemprop="dateModified" datetime="2022-02-16T02:05:38+08:00">2022-02-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="SettingsHelper"><a href="#SettingsHelper" class="headerlink" title="SettingsHelper"></a>SettingsHelper</h1><h3 id="SettingsHelper-自启动设置"><a href="#SettingsHelper-自启动设置" class="headerlink" title="SettingsHelper 自启动设置"></a>SettingsHelper 自启动设置</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.ComponentName</span><br><span class="line"><span class="keyword">import</span> android.content.Context</span><br><span class="line"><span class="keyword">import</span> android.content.Intent</span><br><span class="line"><span class="keyword">import</span> android.net.Uri</span><br><span class="line"><span class="keyword">import</span> android.os.Build</span><br><span class="line"><span class="keyword">import</span> android.provider.Settings</span><br><span class="line"><span class="keyword">import</span> android.util.Log</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 跳转自启动页面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">object</span> AutoStartHelper &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> hashMap = mutableMapOf&lt;String, List&lt;String&gt;&gt;().apply &#123;</span><br><span class="line">        put(</span><br><span class="line">            <span class="string">"Xiaomi"</span>, listOf(</span><br><span class="line">                <span class="string">"com.miui.securitycenter/com.miui.permcenter.autostart.AutoStartManagementActivity"</span>,</span><br><span class="line">                <span class="string">"com.miui.securitycenter"</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">        put(</span><br><span class="line">            <span class="string">"samsung"</span>, listOf(</span><br><span class="line">                <span class="string">"com.samsung.android.sm_cn/com.samsung.android.sm.ui.ram.AutoRunActivity"</span>,</span><br><span class="line">                <span class="string">"com.samsung.android.sm_cn/com.samsung.android.sm.ui.appmanagement.AppManagementActivity"</span>,</span><br><span class="line">                <span class="string">"com.samsung.android.sm_cn/com.samsung.android.sm.ui.cstyleboard.SmartManagerDashBoardActivity"</span>,</span><br><span class="line">                <span class="string">"com.samsung.android.sm_cn/.ui.ram.RamActivity"</span>,</span><br><span class="line">                <span class="string">"com.samsung.android.sm_cn/.app.dashboard.SmartManagerDashBoardActivity"</span>,</span><br><span class="line">                <span class="string">"com.samsung.android.sm/com.samsung.android.sm.ui.ram.AutoRunActivity"</span>,</span><br><span class="line">                <span class="string">"com.samsung.android.sm/com.samsung.android.sm.ui.appmanagement.AppManagementActivity"</span>,</span><br><span class="line">                <span class="string">"com.samsung.android.sm/com.samsung.android.sm.ui.cstyleboard.SmartManagerDashBoardActivity"</span>,</span><br><span class="line">                <span class="string">"com.samsung.android.sm/.ui.ram.RamActivity"</span>,</span><br><span class="line">                <span class="string">"com.samsung.android.sm/.app.dashboard.SmartManagerDashBoardActivity"</span>,</span><br><span class="line">                <span class="string">"com.samsung.android.lool/com.samsung.android.sm.ui.battery.BatteryActivity"</span>,</span><br><span class="line">                <span class="string">"com.samsung.android.sm_cn"</span>,</span><br><span class="line">                <span class="string">"com.samsung.android.sm"</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">        put(</span><br><span class="line">            <span class="string">"HUAWEI"</span>, listOf(</span><br><span class="line">                <span class="string">"com.huawei.systemmanager/.startupmgr.ui.StartupNormalAppListActivity"</span>,</span><br><span class="line">                <span class="string">"com.huawei.systemmanager/.appcontrol.activity.StartupAppControlActivity"</span>,</span><br><span class="line">                <span class="string">"com.huawei.systemmanager/.optimize.process.ProtectActivity"</span>,</span><br><span class="line">                <span class="string">"com.huawei.systemmanager/.optimize.bootstart.BootStartActivity"</span>,</span><br><span class="line">                <span class="comment">//                "com.huawei.systemmanager/com.huawei.permissionmanager.ui.MainActivity", // 这个是隐私-权限管理，但是没有自启动权限！！！</span></span><br><span class="line">                <span class="string">"com.android.settings/com.android.settings.Settings$"</span> + <span class="string">"AppAndNotificationDashboardActivity"</span>, <span class="comment">// 鸿蒙系统，应用和服务，列表中有应用启动管理</span></span><br><span class="line">                <span class="string">"com.huawei.systemmanager"</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">        put(</span><br><span class="line">            <span class="string">"vivo"</span>, listOf(</span><br><span class="line">                <span class="string">"com.iqoo.secure/.ui.phoneoptimize.BgStartUpManager"</span>,</span><br><span class="line">                <span class="string">"com.vivo.permissionmanager/.activity.BgStartUpManagerActivity"</span>,</span><br><span class="line">                <span class="string">"com.vivo.permissionmanager/.activity.SoftPermissionDetailActivity"</span>,</span><br><span class="line">                <span class="string">"com.iqoo.secure/.safeguard.PurviewTabActivity"</span>,</span><br><span class="line">                <span class="string">"com.iqoo.secure"</span>,</span><br><span class="line">                <span class="string">"com.vivo.permissionmanager"</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">        put(</span><br><span class="line">            <span class="string">"Meizu"</span>, listOf(</span><br><span class="line">                <span class="string">"com.meizu.safe/.permission.SmartBGActivity"</span>,</span><br><span class="line">                <span class="string">"com.meizu.safe/.permission.PermissionMainActivity"</span>,</span><br><span class="line">                <span class="string">"com.meizu.safe"</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">        put(</span><br><span class="line">            <span class="string">"OPPO"</span>, listOf(</span><br><span class="line">                <span class="string">"com.coloros.safecenter/.startupapp.StartupAppListActivity"</span>,</span><br><span class="line">                <span class="string">"com.coloros.safecenter/.permission.startup.StartupAppListActivity"</span>,</span><br><span class="line">                <span class="string">"com.oppo.safe/.permission.startup.StartupAppListActivity"</span>,</span><br><span class="line">                <span class="string">"com.coloros.oppoguardelf/com.coloros.powermanager.fuelgaue.PowerUsageModelActivity"</span>,</span><br><span class="line">                <span class="string">"com.coloros.safecenter/com.coloros.privacypermissionsentry.PermissionTopActivity"</span>,</span><br><span class="line">                <span class="string">"com.coloros.safecenter"</span>,</span><br><span class="line">                <span class="string">"com.oppo.safe"</span>,</span><br><span class="line">                <span class="string">"com.coloros.oppoguardelf"</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">        put(</span><br><span class="line">            <span class="string">"oneplus"</span>, listOf(</span><br><span class="line">                <span class="string">"com.oneplus.security/.chainlaunch.view.ChainLaunchAppListActivity"</span>,</span><br><span class="line">                <span class="string">"com.oneplus.security"</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">        put(</span><br><span class="line">            <span class="string">"letv"</span>, listOf(</span><br><span class="line">                <span class="string">"com.letv.android.letvsafe/.AutobootManageActivity"</span>,</span><br><span class="line">                <span class="string">"com.letv.android.letvsafe/.BackgroundAppManageActivity"</span>,</span><br><span class="line">                <span class="string">"com.letv.android.letvsafe"</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">        put(</span><br><span class="line">            <span class="string">"zte"</span>, listOf(</span><br><span class="line">                <span class="string">"com.zte.heartyservice/.autorun.AppAutoRunManager"</span>,</span><br><span class="line">                <span class="string">"com.zte.heartyservice"</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">        <span class="comment">//金立</span></span><br><span class="line">        put(</span><br><span class="line">            <span class="string">"F"</span>, listOf(</span><br><span class="line">                <span class="string">"com.gionee.softmanager/.MainActivity"</span>,</span><br><span class="line">                <span class="string">"com.gionee.softmanager"</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">        <span class="comment">//以下为未确定(厂商名也不确定)</span></span><br><span class="line">        put(</span><br><span class="line">            <span class="string">"smartisanos"</span>, listOf(</span><br><span class="line">                <span class="string">"com.smartisanos.security/.invokeHistory.InvokeHistoryActivity"</span>,</span><br><span class="line">                <span class="string">"com.smartisanos.security"</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">        <span class="comment">//360</span></span><br><span class="line">        put(</span><br><span class="line">            <span class="string">"360"</span>, listOf(</span><br><span class="line">                <span class="string">"com.yulong.android.coolsafe/.ui.activity.autorun.AutoRunListActivity"</span>,</span><br><span class="line">                <span class="string">"com.yulong.android.coolsafe"</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">        <span class="comment">//360</span></span><br><span class="line">        put(</span><br><span class="line">            <span class="string">"ulong"</span>, listOf(</span><br><span class="line">                <span class="string">"com.yulong.android.coolsafe/.ui.activity.autorun.AutoRunListActivity"</span>,</span><br><span class="line">                <span class="string">"com.yulong.android.coolsafe"</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">        <span class="comment">//酷派</span></span><br><span class="line">        put(</span><br><span class="line">            <span class="string">"coolpad"</span> <span class="comment">/*厂商名称不确定是否正确*/</span>, listOf(</span><br><span class="line">                <span class="string">"com.yulong.android.security/com.yulong.android.seccenter.tabbarmain"</span>,</span><br><span class="line">                <span class="string">"com.yulong.android.security"</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">        <span class="comment">//联想</span></span><br><span class="line">        put(</span><br><span class="line">            <span class="string">"lenovo"</span> <span class="comment">/*厂商名称不确定是否正确*/</span>, listOf(</span><br><span class="line">                <span class="string">"com.lenovo.security/.purebackground.PureBackgroundActivity"</span>,</span><br><span class="line">                <span class="string">"com.lenovo.security"</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">        put(</span><br><span class="line">            <span class="string">"htc"</span> <span class="comment">/*厂商名称不确定是否正确*/</span>, listOf(</span><br><span class="line">                <span class="string">"com.htc.pitroad/.landingpage.activity.LandingPageActivity"</span>,</span><br><span class="line">                <span class="string">"com.htc.pitroad"</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">        <span class="comment">//华硕</span></span><br><span class="line">        put(</span><br><span class="line">            <span class="string">"asus"</span> <span class="comment">/*厂商名称不确定是否正确*/</span>, listOf(</span><br><span class="line">                <span class="string">"com.asus.mobilemanager/.MainActivity"</span>,</span><br><span class="line">                <span class="string">"com.asus.mobilemanager"</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">        <span class="comment">//酷派</span></span><br><span class="line">        put(</span><br><span class="line">            <span class="string">"YuLong"</span>, listOf(</span><br><span class="line">                <span class="string">"com.yulong.android.softmanager/.SpeedupActivity"</span>,</span><br><span class="line">                <span class="string">"com.yulong.android.security/com.yulong.android.seccenter.tabbarmain"</span>,</span><br><span class="line">                <span class="string">"com.yulong.android.security"</span></span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">startAutoBootSetting</span><span class="params">(context: <span class="type">Context</span>?)</span></span> &#123;</span><br><span class="line">        Log.e(<span class="string">"AutoStartHelper"</span>, <span class="string">"当前手机型号为："</span> + Build.MANUFACTURER)</span><br><span class="line">        <span class="keyword">var</span> result = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">        run <span class="symbol">start0@</span>&#123;</span><br><span class="line">            <span class="keyword">for</span> ((manufacturer, componentNameList) <span class="keyword">in</span> hashMap) &#123;</span><br><span class="line">                <span class="keyword">if</span> (Build.MANUFACTURER.equals(manufacturer, ignoreCase = <span class="literal">true</span>)) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (actName <span class="keyword">in</span> componentNameList) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">var</span> intent: Intent? = <span class="literal">null</span></span><br><span class="line">                            <span class="keyword">if</span> (actName.contains(<span class="string">"/"</span>)) &#123;</span><br><span class="line">                                intent = Intent()</span><br><span class="line">                                intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)</span><br><span class="line">                                intent.component = ComponentName.unflattenFromString(actName)</span><br><span class="line">                                <span class="keyword">if</span> (actName.contains(<span class="string">"SoftPermissionDetailActivity"</span>)) &#123;</span><br><span class="line">                                    intent.putExtra(<span class="string">"packagename"</span>, context?.packageName)</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="comment">//                            else &#123;</span></span><br><span class="line">                            <span class="comment">//                                // 跳转到对应的安全管家/安全中心</span></span><br><span class="line">                            <span class="comment">//                                intent = context?.packageManager?.getLaunchIntentForPackage(actName)</span></span><br><span class="line">                            <span class="comment">//                            &#125;</span></span><br><span class="line">                            intent?.let &#123;</span><br><span class="line">                                context?.startActivity(intent)</span><br><span class="line">                                result = <span class="literal">true</span></span><br><span class="line">                                <span class="keyword">return</span><span class="symbol">@start0</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">                            e.printStackTrace()</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!result) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 跳转到app详情设置</span></span><br><span class="line">                <span class="keyword">val</span> intent = Intent()</span><br><span class="line">                intent.flags = Intent.FLAG_ACTIVITY_NEW_TASK</span><br><span class="line">                intent.action = Settings.ACTION_APPLICATION_DETAILS_SETTINGS</span><br><span class="line">                intent.<span class="keyword">data</span> = Uri.fromParts(<span class="string">"package"</span>, context?.packageName, <span class="literal">null</span>)</span><br><span class="line">                context?.startActivity(intent)</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">                e.printStackTrace()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://denchopen.github.io/blog/2022/01/04/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B8%83%E5%B1%80-SpannableString%E4%B9%8B%E5%B1%85%E4%B8%AD%E6%98%BE%E7%A4%BAImageSpan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.png">
      <meta itemprop="name" content="Dench">
      <meta itemprop="description" content="Love & Peace">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人小站">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2022/01/04/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B8%83%E5%B1%80-SpannableString%E4%B9%8B%E5%B1%85%E4%B8%AD%E6%98%BE%E7%A4%BAImageSpan/" class="post-title-link" itemprop="url">SpannableString 之居中显示 ImageSpan</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-04 21:03:13 / 修改时间：19:32:40" itemprop="dateCreated datePublished" datetime="2022-01-04T21:03:13+08:00">2022-01-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="自定义布局：SpannableString-之居中显示-ImageSpan"><a href="#自定义布局：SpannableString-之居中显示-ImageSpan" class="headerlink" title="自定义布局：SpannableString 之居中显示 ImageSpan"></a>自定义布局：SpannableString 之居中显示 ImageSpan</h3><img src="https://s2.loli.net/2022/01/04/8rhcKDBaWQvA74V.png" alt="image-20220104185114603" style="zoom:50%;" />

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CenteredImageSpan</span></span>(context: Context, drawableRes: <span class="built_in">Int</span>) : ImageSpan(context, drawableRes) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">draw</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        canvas: <span class="type">Canvas</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        text: <span class="type">CharSequence</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        start: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        end: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        x: <span class="type">Float</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        top: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        y: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        bottom: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        paint: <span class="type">Paint</span></span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span> &#123;</span><br><span class="line">        <span class="comment">// image to draw</span></span><br><span class="line">        <span class="keyword">val</span> b = drawable</span><br><span class="line">        <span class="comment">// font metrics of text to be replaced</span></span><br><span class="line">        <span class="keyword">val</span> fm = paint.fontMetricsInt</span><br><span class="line">        <span class="keyword">var</span> transY = ((y + fm.descent + y + fm.ascent) / <span class="number">2</span> - b.bounds.bottom / <span class="number">2</span>)</span><br><span class="line">        <span class="comment">// to check the last line.(当 image 在单独一行显示时可能会存在这个问题）</span></span><br><span class="line">        <span class="keyword">if</span> (transY &gt; bottom - b.bounds.bottom) transY = bottom - b.bounds.bottom</span><br><span class="line">        canvas.save()</span><br><span class="line">        canvas.translate(x, transY.toFloat())</span><br><span class="line">        b.draw(canvas)</span><br><span class="line">        canvas.restore()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> spanStr = SpannableStringBuilder()</span><br><span class="line">spanStr.append(<span class="string">"# "</span>)</span><br><span class="line">spanStr.append(title)</span><br><span class="line"><span class="keyword">val</span> imageSpan = CenteredImageSpan(<span class="keyword">this</span>, R.mipmap.ic_topic_detail_jinghao_black)</span><br><span class="line">spanStr.setSpan(imageSpan, <span class="number">0</span>, <span class="number">1</span>, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE)</span><br><span class="line"><span class="comment">// corner</span></span><br><span class="line">spanStr.append(<span class="string">" #"</span>)</span><br><span class="line"><span class="keyword">val</span> len = spanStr.length</span><br><span class="line"><span class="keyword">val</span> cornerSpan = CenteredImageSpan(<span class="keyword">this</span>,  R.mipmap.ic_topic_detail_remen)</span><br><span class="line">spanStr.setSpan(cornerSpan, len - <span class="number">1</span>, len, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE)</span><br><span class="line">binding.ctTalkDetailInfo.talkNameTv.text = spanStr</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://denchopen.github.io/blog/2021/12/07/Android%E4%B8%93%E6%A0%8F-FileProvider/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.png">
      <meta itemprop="name" content="Dench">
      <meta itemprop="description" content="Love & Peace">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人小站">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2021/12/07/Android%E4%B8%93%E6%A0%8F-FileProvider/" class="post-title-link" itemprop="url">FileProvider 的使用</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-07 19:15:25" itemprop="dateCreated datePublished" datetime="2021-12-07T19:15:25+08:00">2021-12-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-08 01:35:48" itemprop="dateModified" datetime="2021-12-08T01:35:48+08:00">2021-12-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="FileProvider-的使用"><a href="#FileProvider-的使用" class="headerlink" title="FileProvider 的使用"></a>FileProvider 的使用</h2><p>Dev Doc</p>
<p><a href="https://developer.android.google.cn/reference/androidx/core/content/FileProvider" target="_blank" rel="noopener">https://developer.android.google.cn/reference/androidx/core/content/FileProvider</a></p>
<h3 id="0x01-定义一个FileProvider"><a href="#0x01-定义一个FileProvider" class="headerlink" title="0x01 定义一个FileProvider"></a>0x01 定义一个FileProvider</h3><p>在 androidx 包提供的 FileProvider 提供了 生成文件Uri 的功能。</p>
<p>在 manifest 文件中，声明一个 provider</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">        <span class="tag">&lt;<span class="name">provider</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">android:name</span>=<span class="string">"androidx.core.content.FileProvider"</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">android:authorities</span>=<span class="string">"$&#123;applicationId&#125;.fileprovider"</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">android:exported</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">android:grantUriPermissions</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">tools:replace</span>=<span class="string">"android:authorities"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">android:name</span>=<span class="string">"android.support.FILE_PROVIDER_PATHS"</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">android:resource</span>=<span class="string">"@xml/file_paths"</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">tools:replace</span>=<span class="string">"android:resource"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="0x02-可用文件路径配置"><a href="#0x02-可用文件路径配置" class="headerlink" title="0x02 可用文件路径配置"></a>0x02 可用文件路径配置</h3><p>在 res/xml/file_paths.xml 下配置可用的文件路径，FileProvider 只能生成配置了的文件Uri。每个你想要生成Uri的文件路径都需要在 paths 下面定义。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">paths</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">files-path</span> <span class="attr">name</span>=<span class="string">"my_images"</span> <span class="attr">path</span>=<span class="string">"images/"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache-path</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">path</span>=<span class="string">"path"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">external-path</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">path</span>=<span class="string">"path"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">external-files-path</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">path</span>=<span class="string">"path"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">external-cache-path</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">path</span>=<span class="string">"path"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">external-media-path</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">path</span>=<span class="string">"path"</span> /&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">paths</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="0x03-生成一个Uri"><a href="#0x03-生成一个Uri" class="headerlink" title="0x03 生成一个Uri"></a>0x03 生成一个Uri</h3><p>和其他 app 共享一个文件，你需要生成一个Uri。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">File imagePath = <span class="keyword">new</span> File(Context.getFilesDir(), <span class="string">"my_images"</span>);</span><br><span class="line">File newFile = <span class="keyword">new</span> File(imagePath, <span class="string">"default_image.jpg"</span>);</span><br><span class="line"></span><br><span class="line">Uri uriForFile;</span><br><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</span><br><span class="line">    uriForFile = FileProvider.getUriForFile(mContext, mContext.getPackageName() + <span class="string">".fileprovider"</span>, newFile);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    uriForFile = Uri.parse(<span class="string">"file://"</span> + newFile.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>getUriForFile()</code> 返回一个 content URI <code>content://com.mydomain.fileprovider/my_images/default_image.jpg</code>.</p>
<h3 id="0x04-授予权限"><a href="#0x04-授予权限" class="headerlink" title="0x04 授予权限"></a>0x04 授予权限</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shareContentIntent.setClipData(ClipData.newRawUri(<span class="string">""</span>, contentUri));</span><br><span class="line">shareContentIntent.addFlags(</span><br><span class="line">         Intent.FLAG_GRANT_READ_URI_PERMISSION | Intent.FLAG_GRANT_WRITE_URI_PERMISSION);</span><br></pre></td></tr></table></figure>

<ol>
<li>Put the content URI in an <code>Intent</code> by calling <code>setData()</code>.</li>
<li>Call the method <code>Intent.setFlags()</code> with either <code>Intent.FLAG_GRANT_READ_URI_PERMISSION</code> or <code>Intent.FLAG_GRANT_WRITE_URI_PERMISSION</code> or both.</li>
<li>Send the <code>Intent</code> to another app. Most often, you do this by calling <code>setResult()</code>.</li>
</ol>
<h3 id="0x05-提供Uri给其他app"><a href="#0x05-提供Uri给其他app" class="headerlink" title="0x05 提供Uri给其他app"></a>0x05 提供Uri给其他app</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用uri</span></span><br><span class="line">Intent i = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW);</span><br><span class="line">i.setFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);</span><br><span class="line">i.setDataAndType(uriForFile, <span class="string">"application/vnd.android.package-archive"</span>);</span><br><span class="line">mContext.startActivity(i);</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://denchopen.github.io/blog/2021/12/06/Problems%E4%B8%93%E9%A2%98%E4%B9%8BProvider/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.png">
      <meta itemprop="name" content="Dench">
      <meta itemprop="description" content="Love & Peace">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人小站">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2021/12/06/Problems%E4%B8%93%E9%A2%98%E4%B9%8BProvider/" class="post-title-link" itemprop="url">Problems专题：Provider</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-06 22:22:22" itemprop="dateCreated datePublished" datetime="2021-12-06T22:22:22+08:00">2021-12-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-08 01:31:32" itemprop="dateModified" datetime="2021-12-08T01:31:32+08:00">2021-12-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Problems专题：Provider"><a href="#Problems专题：Provider" class="headerlink" title="Problems专题：Provider"></a>Problems专题：Provider</h2><h3 id="0x01-FileProvider：Failed-to-find-configured-root-that-contains-…-jpeg"><a href="#0x01-FileProvider：Failed-to-find-configured-root-that-contains-…-jpeg" class="headerlink" title="0x01  FileProvider：Failed to find configured root that contains /…/**.jpeg"></a>0x01  FileProvider：Failed to find configured root that contains /…/**.jpeg</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalArgumentException: Failed to find configured root that contains /storage/emulated/0/DCIM/Camera/**.jpeg</span><br><span class="line">	at androidx.core.content.FileProvider$SimplePathStrategy.getUriForFile(FileProvider.java:800)</span><br><span class="line">	at androidx.core.content.FileProvider.getUriForFile(FileProvider.java:442)</span><br><span class="line">	at com.luck.picture.lib.tools.PictureFileUtils.parUri(PictureFileUtils.java:533)</span><br><span class="line">	at com.luck.picture.lib.PictureBaseActivity.startOpenCameraImage(PictureBaseActivity.java:705)</span><br><span class="line">	at com.luck.picture.lib.PictureSelectorActivity.startCamera(PictureSelectorActivity.java:926)</span><br><span class="line">	at com.luck.picture.lib.PictureSelectorActivity.onTakePhoto(PictureSelectorActivity.java:1473)</span><br><span class="line">	at com.luck.picture.lib.adapter.PictureImageGridAdapter.lambda$onBindViewHolder$0$PictureImageGridAdapter(PictureImageGridAdapter.java:155)</span><br><span class="line">	at com.luck.picture.lib.adapter.-$$Lambda$PictureImageGridAdapter$0EODmJcP4VP0lqmkEhQ1dzLbHi8.onClick(Unknown Source:2)</span><br><span class="line">	at android.view.View.performClick(View.java:6608)</span><br><span class="line">	at android.view.View.performClickInternal(View.java:6585)</span><br><span class="line">	at android.view.View.access$3100(View.java:785)</span><br><span class="line">	at android.view.View$PerformClick.run(View.java:25921)</span><br><span class="line">	at android.os.Handler.handleCallback(Handler.java:873)</span><br><span class="line">	at android.os.Handler.dispatchMessage(Handler.java:99)</span><br><span class="line">	at android.os.Looper.loop(Looper.java:201)</span><br><span class="line">	at android.app.ActivityThread.main(ActivityThread.java:6810)</span><br><span class="line">	at java.lang.reflect.Method.invoke(Native Method)</span><br><span class="line">	at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:547)</span><br><span class="line">	at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:873)</span><br><span class="line">Back traces end.</span><br></pre></td></tr></table></figure>

<p><strong>问题分析</strong></p>
<ol>
<li>FileProvider 路径配置文件被互相覆盖</li>
<li>FileProvider 路径配置文件id重复，导致覆盖</li>
</ol>
<p><strong>解决方案</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://denchopen.github.io/blog/2021/11/30/Kotlin%E5%8D%95%E4%BE%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.png">
      <meta itemprop="name" content="Dench">
      <meta itemprop="description" content="Love & Peace">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人小站">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2021/11/30/Kotlin%E5%8D%95%E4%BE%8B/" class="post-title-link" itemprop="url">Kotlin单例</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-30 22:16:30" itemprop="dateCreated datePublished" datetime="2021-11-30T22:16:30+08:00">2021-11-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-08 01:31:32" itemprop="dateModified" datetime="2021-12-08T01:31:32+08:00">2021-12-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Kotlin单例"><a href="#Kotlin单例" class="headerlink" title="Kotlin单例"></a>Kotlin单例</h3><p>下面介绍一下kotlin 线程安全的几种单例写法。</p>
<h3 id="0x01-饿汉模式"><a href="#0x01-饿汉模式" class="headerlink" title="0x01 饿汉模式"></a>0x01 饿汉模式</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Kotlin实现</span></span><br><span class="line"><span class="keyword">object</span> Singleton &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 反编译Kotlin实现的Java代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton INSTANCE;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">static</span> &#123;</span><br><span class="line">      Singleton var0 = <span class="keyword">new</span> Singleton();</span><br><span class="line">      INSTANCE = var0;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="0x02-双重校验锁式"><a href="#0x02-双重校验锁式" class="headerlink" title="0x02 双重校验锁式"></a>0x02 双重校验锁式</h3><p>双重校验锁式（Double Check)</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Kotlin实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> <span class="keyword">private</span> <span class="keyword">constructor</span></span>() &#123;</span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="meta">@Volatile</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">var</span> instance: Singleton? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">@JvmStatic</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">getInstance</span><span class="params">()</span></span>: Singleton &#123;</span><br><span class="line">            <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                synchronized(Singleton::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                        instance = Singleton()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> instance!!</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 反编译Kotlin实现的Java代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton.Companion Companion = <span class="keyword">new</span> Singleton.Companion((DefaultConstructorMarker)<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// $FF: synthetic method</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Singleton</span><span class="params">(DefaultConstructorMarker $constructor_marker)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@JvmStatic</span></span><br><span class="line">   <span class="meta">@NotNull</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> Companion.getInstance();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Companion</span> </span>&#123;</span><br><span class="line">      <span class="meta">@JvmStatic</span></span><br><span class="line">      <span class="meta">@NotNull</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">if</span> (Singleton.instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            Class var1 = Singleton<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line">            <span class="keyword">boolean</span> var2 = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">boolean</span> var3 = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">synchronized</span>(var1) &#123;</span><br><span class="line">               <span class="keyword">int</span> var4 = <span class="keyword">false</span>;</span><br><span class="line">               <span class="keyword">if</span> (Singleton.instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                  Singleton.instance = <span class="keyword">new</span> Singleton((DefaultConstructorMarker)<span class="keyword">null</span>);</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               Unit var6 = Unit.INSTANCE;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         Singleton var10000 = Singleton.instance;</span><br><span class="line">         <span class="keyword">if</span> (var10000 == <span class="keyword">null</span>) &#123;</span><br><span class="line">            Intrinsics.throwNpe();</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">return</span> var10000;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">private</span> <span class="title">Companion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// $FF: synthetic method</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="title">Companion</span><span class="params">(DefaultConstructorMarker $constructor_marker)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">this</span>();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="0x03-静态内部类"><a href="#0x03-静态内部类" class="headerlink" title="0x03 静态内部类"></a>0x03 静态内部类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Java实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> SingletonDemo instance=<span class="keyword">new</span> SingletonDemo();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonDemo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Singleton has loaded"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonDemo <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Kotlin实现</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> <span class="keyword">private</span> <span class="keyword">constructor</span></span>() &#123;</span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="meta">@JvmStatic</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">getInstance</span><span class="params">()</span></span> = SingletonHolder.instance</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">object</span> SingletonHolder &#123;</span><br><span class="line">        <span class="meta">@JvmStatic</span></span><br><span class="line">        <span class="keyword">val</span> instance: Singleton = Singleton()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 反编译Kotlin实现的Java代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton.Companion Companion = <span class="keyword">new</span> Singleton.Companion((DefaultConstructorMarker)<span class="keyword">null</span>);</span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta">@JvmStatic</span></span><br><span class="line">   <span class="meta">@NotNull</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> Companion.getInstance();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span> </span>&#123;</span><br><span class="line">      <span class="meta">@NotNull</span></span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton instance;</span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton.SingletonHolder INSTANCE;</span><br><span class="line">      <span class="meta">@NotNull</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> instance;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">static</span> &#123;</span><br><span class="line">         Singleton.SingletonHolder var0 = <span class="keyword">new</span> Singleton.SingletonHolder();</span><br><span class="line">         INSTANCE = var0;</span><br><span class="line">         instance = <span class="keyword">new</span> Singleton((DefaultConstructorMarker)<span class="keyword">null</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Companion</span> </span>&#123;</span><br><span class="line">      <span class="meta">@JvmStatic</span></span><br><span class="line">      <span class="meta">@NotNull</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> Singleton.SingletonHolder.getInstance();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="function"><span class="keyword">private</span> <span class="title">Companion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/blog/">1</a><a class="page-number" href="/blog/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/blog/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/13/">13</a><a class="extend next" rel="next" href="/blog/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Dench"
      src="/blog/images/avatar.png">
  <p class="site-author-name" itemprop="name">Dench</p>
  <div class="site-description" itemprop="description">Love & Peace</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">75</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">DenchOpen</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/pisces.js"></script>


<script src="/blog/js/next-boot.js"></script>




  















  

  

</body>
</html>
