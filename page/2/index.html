<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>个人小站</title><link rel="manifest" href="/blog/manifest.json"><meta name="theme-color" content="#f7f7f7"><meta name="application-name" content="Icaurs - Hexo Theme"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="msapplication-TileColor" content="#f7f7f7"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Icaurs - Hexo Theme"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Life is a coding."><meta property="og:type" content="blog"><meta property="og:title" content="个人小站"><meta property="og:url" content="https://denchopen.github.io/blog"><meta property="og:site_name" content="个人小站"><meta property="og:description" content="Life is a coding."><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://denchopen.github.io/blog/img/og_image.png"><meta property="article:author" content="Dench"><meta property="article:tag" content="Android, Hexo, NexT, Icarus"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://denchopen.github.io/blog/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://denchopen.github.io/blog"},"headline":"个人小站","image":["https://denchopen.github.io/blog/img/og_image.png"],"author":{"@type":"Person","name":"Dench"},"publisher":{"@type":"Organization","name":"个人小站","logo":{"@type":"ImageObject","url":"https://denchopen.github.io/img/logo.svg"}},"description":"Life is a coding."}</script><link rel="icon" href="/blog/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/xt256.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Oxanium:wght@300;400;600&amp;family=Roboto+Mono"><link rel="stylesheet" href="/blog/css/cyberpunk.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-72437521-5" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-72437521-5');</script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/blog/"><img src="/blog/img/logo.svg" alt="个人小站" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/blog/">Home</a><a class="navbar-item" href="/blog/archives">Archives</a><a class="navbar-item" href="/blog/categories">Categories</a><a class="navbar-item" href="/blog/tags">Tags</a><a class="navbar-item" href="/blog/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Discuss on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus/discussions"><i class="fas fa-comments"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-12-01T12:16:25.000Z" title="2022-12-1 8:16:25 ├F10: PM┤">2022-12-01</time>发表</span><span class="level-item">1 分钟读完 (大约135个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/2022/12/01/Android%E9%A6%96%E9%A1%B5%E7%81%B0%E8%89%B2%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88/">Android首页灰色实现方案</a></p><div class="content"><h3 id="Activity设置灰色"><a href="#Activity设置灰色" class="headerlink" title="Activity设置灰色"></a>Activity设置灰色</h3><p>使用<code>ColorMatrix</code>设置灰度</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">setGrayPaint</span><span class="params">(view: <span class="type">View</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> paint = Paint()</span><br><span class="line">    <span class="keyword">val</span> cm = ColorMatrix()</span><br><span class="line">    cm.setSaturation(<span class="number">0f</span>)</span><br><span class="line">    paint.colorFilter = ColorMatrixColorFilter(cm)</span><br><span class="line">    view.setLayerType(View.LAYER_TYPE_HARDWARE, paint)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>给首页Activity的decorView设置灰度Paint</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">    </span><br><span class="line">    setContentView(...)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 需要在 setContentView 之后</span></span><br><span class="line">    setGrayPaint(window.decorView)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="需要特殊处理的控件"><a href="#需要特殊处理的控件" class="headerlink" title="需要特殊处理的控件"></a>需要特殊处理的控件</h3><ul>
<li>弹框</li>
<li>WebView</li>
<li>SurfaceView</li>
</ul>
<p>这些控件由于不是跟activity公用一个window，需要各自单独处理灰度Paint。调用 <code>setGrayPaint(view)</code> 即可。</p>
<h3 id="相关资源"><a href="#相关资源" class="headerlink" title="相关资源"></a>相关资源</h3><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7041773908915126285">Android实现设置灰白模式效果</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-11-26T11:16:25.000Z" title="2022-11-26 7:16:25 ├F10: PM┤">2022-11-26</time>发表</span><span class="level-item">8 分钟读完 (大约1194个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/2022/11/26/Android%E4%B8%93%E6%A0%8F-%E5%BE%AE%E4%BF%A1AndResGuard%E8%B5%84%E6%BA%90%E6%B7%B7%E6%B7%86%E5%B7%A5%E5%85%B7/">微信AndResGuard资源混淆工具</a></p><div class="content"><h2 id="微信AndResGuard资源混淆工具"><a href="#微信AndResGuard资源混淆工具" class="headerlink" title="微信AndResGuard资源混淆工具"></a>微信AndResGuard资源混淆工具</h2><p>AndResGuard是一个帮助你缩小APK大小的工具，他的原理类似Java Proguard，但是只针对资源。他会将原本冗长的资源路径变短，例如将res/drawable/wechat变为r/d/a。</p>
<p>AndResGuard不涉及编译过程，只需输入一个apk(无论签名与否，debug版，release版均可，在处理过程中会直接将原签名删除)，可得到一个实现资源混淆后的apk(若在配置文件中输入签名信息，可自动重签名并对齐，得到可直接发布的apk)以及对应资源ID的mapping文件。</p>
<h3 id="原理介绍"><a href="#原理介绍" class="headerlink" title="原理介绍"></a>原理介绍</h3><p>根据Android的编译流程，所有资源ID已经被编译成32位int值。这说明我们并不需要去修改xml与java，因为在编译过程已经被R.java所替换，我们直接修改<code>resources.arsc</code>的二进制数据，不改变打包流程，只要在生成resources.arsc之后修改它，同时重命名资源文件。</p>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ul>
<li>缩小APK体积</li>
<li>保护res资源文件的可读性</li>
<li>皮应用中减少跟主应用代码的重复率</li>
</ul>
<h3 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h3><p>项目根目录下build.gradle中，添加插件的依赖：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">        google()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath <span class="string">&#x27;com.tencent.mm:AndResGuard-gradle-plugin:1.2.21&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>app模块下的build.gradle中添加相关配置</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">&#x27;AndResGuard&#x27;</span></span><br><span class="line"></span><br><span class="line">andResGuard &#123;</span><br><span class="line">    <span class="comment">// mappingFile = file(&quot;./resource_mapping.txt&quot;)</span></span><br><span class="line">    mappingFile = <span class="literal">null</span></span><br><span class="line">    use7zip = <span class="literal">true</span></span><br><span class="line">    useSign = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// 打开这个开关，会keep住所有资源的原始路径，只混淆资源的名字</span></span><br><span class="line">    keepRoot = <span class="literal">false</span></span><br><span class="line">    <span class="comment">// 设置这个值，会把arsc name列混淆成相同的名字，减少string常量池的大小</span></span><br><span class="line">    fixedResName = <span class="string">&quot;arg&quot;</span></span><br><span class="line">    <span class="comment">// 打开这个开关会合并所有哈希值相同的资源，但请不要过度依赖这个功能去除去冗余资源</span></span><br><span class="line">    mergeDuplicatedRes = <span class="literal">true</span></span><br><span class="line">    whiteList = [</span><br><span class="line">        <span class="comment">// for your icon</span></span><br><span class="line">        <span class="string">&quot;R.drawable.icon&quot;</span>,</span><br><span class="line">        <span class="comment">// for fabric</span></span><br><span class="line">        <span class="string">&quot;R.string.com.crashlytics.*&quot;</span>,</span><br><span class="line">        <span class="comment">// for google-services</span></span><br><span class="line">        <span class="string">&quot;R.string.google_app_id&quot;</span>,</span><br><span class="line">        <span class="string">&quot;R.string.gcm_defaultSenderId&quot;</span>,</span><br><span class="line">        <span class="string">&quot;R.string.default_web_client_id&quot;</span>,</span><br><span class="line">        <span class="string">&quot;R.string.ga_trackingId&quot;</span>,</span><br><span class="line">        <span class="string">&quot;R.string.firebase_database_url&quot;</span>,</span><br><span class="line">        <span class="string">&quot;R.string.google_api_key&quot;</span>,</span><br><span class="line">        <span class="string">&quot;R.string.google_crash_reporting_api_key&quot;</span></span><br><span class="line">    ]</span><br><span class="line">    compressFilePattern = [</span><br><span class="line">        <span class="string">&quot;*.png&quot;</span>,</span><br><span class="line">        <span class="string">&quot;*.jpg&quot;</span>,</span><br><span class="line">        <span class="string">&quot;*.jpeg&quot;</span>,</span><br><span class="line">        <span class="string">&quot;*.gif&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">    sevenzip &#123;</span><br><span class="line">         artifact = <span class="string">&#x27;com.tencent.mm:SevenZip:1.2.21&#x27;</span></span><br><span class="line">         <span class="comment">//path = &quot;/usr/local/bin/7za&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 可选： 如果不设置则会默认覆盖assemble输出的apk</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="comment">// finalApkBackupPath = &quot;$&#123;project.rootDir&#125;/final.apk&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 可选: 指定v1签名时生成jar文件的摘要算法</span></span><br><span class="line"><span class="comment">    * 默认值为“SHA-1”</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="comment">// digestalg = &quot;SHA-256&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="如何启动"><a href="#如何启动" class="headerlink" title="如何启动"></a>如何启动</h3><p>使用Android Studio的同学可以再 andresguard 下找到相关的构建任务; 命令行可直接运行./gradlew resguard[BuildType | Flavor]， 这里的任务命令规则和assemble一致。</p>
<h3 id="配置7Zip"><a href="#配置7Zip" class="headerlink" title="配置7Zip"></a>配置7Zip</h3><p>在设置sevenzip时, 你只需设置artifact或path. 支持同时设置,总以path的值为优先.</p>
<h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><p>如果没有配置finalApkBackupPath，最终结果会覆盖assemble[BuildType | Flavor]的输出APK。如果配置则输出至finalApkBackupPath配置路径。</p>
<h3 id="一些需要注意的问题"><a href="#一些需要注意的问题" class="headerlink" title="一些需要注意的问题"></a>一些需要注意的问题</h3><ul>
<li>如果不是对APK size有极致的需求，请不要把resources.arsc添加进compressFilePattern.</li>
<li>对于发布于Google Play的APP，建议不要使用7Zip压缩，因为这个会导致Google Play的优化Patch算法失效.</li>
<li>compress参数对混淆效果的影响<br>若指定compess 参数.png、.gif以及*.jpg，resources.arsc会大大减少安装包体积。若要支持2.2，resources.arsc需保证压缩前小于1M。</li>
<li>操作系统对7z的影响<br>实验证明，linux与mac的7z效果更好</li>
<li>keepmapping方式对增量包大小的影响<br>影响并不大，但使用keepmapping方式有利于保持所有版本混淆的一致性</li>
<li>渠道包的问题(<strong>建议通过修改zip摘要的方式生产渠道包</strong>)<br>在出渠道包的时候，解压重压缩会破坏7zip的效果，通过repackage命令可用7zip重压缩。</li>
<li>通过getIdentifier方式获得资源，需要放置白名单中。</li>
<li>部分手机桌面快捷图标的实现有问题，务必将程序桌面icon加入白名单</li>
<li>第三方SDK的资源加入白名单。可以在<code>white_list.md</code><a target="_blank" rel="noopener" href="https://github.com/shwenzhang/AndResGuard/blob/master/doc/white_list.md">https://github.com/shwenzhang/AndResGuard/blob/master/doc/white_list.md</a>查看更多sdk的白名单配置</li>
<li>Glide加载本地资源需要加入白名单。</li>
</ul>
<h3 id="相关资源"><a href="#相关资源" class="headerlink" title="相关资源"></a>相关资源</h3><p>使用说明：<a target="_blank" rel="noopener" href="https://github.com/shwenzhang/AndResGuard/blob/master/README.zh-cn.md">https://github.com/shwenzhang/AndResGuard/blob/master/README.zh-cn.md</a></p>
<p>原理介绍：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzAwNDY1ODY2OQ==&mid=208135658&idx=1&sn=ac9bd6b4927e9e82f9fa14e396183a8f#rd">https://mp.weixin.qq.com/s?__biz=MzAwNDY1ODY2OQ==&amp;mid=208135658&amp;idx=1&amp;sn=ac9bd6b4927e9e82f9fa14e396183a8f#rd</a></p>
<p><code>white_list.md</code>：<a target="_blank" rel="noopener" href="https://github.com/shwenzhang/AndResGuard/blob/master/doc/white_list.md">https://github.com/shwenzhang/AndResGuard/blob/master/doc/white_list.md</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-10-11T17:09:31.000Z" title="2022-10-12 1:09:31 ├F10: AM┤">2022-10-12</time>发表</span><span class="level-item">3 分钟读完 (大约434个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/2022/10/12/%E7%AE%97%E6%B3%95-%E9%93%BE%E8%A1%A8Java%E7%89%88/">链表(Java版)</a></p><div class="content"><h2 id="链表-Java版"><a href="#链表-Java版" class="headerlink" title="链表(Java版)"></a>链表(Java版)</h2><p>在链表操作中，我们通常通过生成一个 dummy 哑节点，来避免空链表的判断。</p>
<h3 id="19-删除链表的倒数第-N-个结点"><a href="#19-删除链表的倒数第-N-个结点" class="headerlink" title="19.删除链表的倒数第 N 个结点"></a>19.删除链表的倒数第 N 个结点</h3><p>方法一：计算链表长度</p>
<p>为了方便删除操作，我们可以从哑节点开始遍历 L−n+1 个节点。当遍历到第 L−n+1 个节点时，它的下一个节点就是我们需要删除的节点，这样我们只需要修改一次指针，就能完成删除操作。</p>
<p>方法三：双指针</p>
<p>我们可以使用两个指针 first 和 second 同时对链表进行遍历，并且 first 比 second 超前 n 个节点。当 first 遍历到链表的末尾时，second 就恰好处于倒数第 n 个节点。</p>
<p>时间复杂度：O(L)，其中 L 是链表的长度。<br>空间复杂度：O(1)。</p>
<h3 id="21-合并两个有序链表"><a href="#21-合并两个有序链表" class="headerlink" title="21.合并两个有序链表"></a>21.合并两个有序链表</h3><ol>
<li>当 l1 和 l2 都不是空链表时，判断 l1 和 l2 哪一个链表的头节点的值更小，将较小值的节点添加到结果里。</li>
<li>当 l1 和 l2 有一个是空的,只需要简单地将非空链表接在合并链表的后面。</li>
</ol>
<h3 id="23-合并K个升序链表"><a href="#23-合并K个升序链表" class="headerlink" title="23.合并K个升序链表"></a>23.合并K个升序链表</h3><p>方法一：顺序合并</p>
<p>已经有合并两个有序链表的前提，直接遍历数组，依次合并两个链表得到结果。</p>
<p>方法二：分治合并</p>
<p>将 k 个链表分组并将同一组中的链表合并（递归实现）</p>
<p>进时间复杂度为 <code>O(kn×logk)</code><br>空间复杂度,递归会使用到 <code>O(logk)</code> 空间代价的栈空间</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-10-09T17:08:08.000Z" title="2022-10-10 1:08:08 ├F10: AM┤">2022-10-10</time>发表</span><span class="level-item">4 分钟读完 (大约631个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/2022/10/10/Android%E5%8A%A8%E6%80%81%E6%9D%83%E9%99%90%E7%94%B3%E8%AF%B7@2022/">Android动态权限申请</a></p><div class="content"><h1 id="Android动态权限申请"><a href="#Android动态权限申请" class="headerlink" title="Android动态权限申请"></a>Android动态权限申请</h1><h4 id="0x01-介绍"><a href="#0x01-介绍" class="headerlink" title="0x01 介绍"></a>0x01 介绍</h4><p>由于 Android 动态权限申请是一个交互比较复杂的模块，整个申请的流程也比较长，所以，写了一个工具来封装了一个，也具体的实现了一个流程。</p>
<p>由于每个App的Ui风格不一致，所以没有把Toast和弹框封装进工具，等后期有好的想法再优化。</p>
<h4 id="0x02-动态权限申请流程"><a href="#0x02-动态权限申请流程" class="headerlink" title="0x02 动态权限申请流程"></a>0x02 动态权限申请流程</h4><ol>
<li>检查授权状态</li>
<li>申请权限</li>
<li>处理权限申请结果</li>
<li>当用户‘拒绝且不再询问’，引导去手机设置</li>
<li>检查手机设置后的权限申请结果</li>
</ol>
<h4 id="0x03-使用说明"><a href="#0x03-使用说明" class="headerlink" title="0x03 使用说明"></a>0x03 使用说明</h4><p>主要封装类 <code>PermissionManager</code></p>
<p>根据业务需要用到安卓定义的高危权限，需要去动态申请权权限。通常是在Activity 和 Fragment 组件中发起。</p>
<p>1 检查权限授权状态</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (PermissionManager.hasPermissions(<span class="keyword">this</span>, Manifest.permission.READ_PHONE_STATE)) &#123;</span><br><span class="line">    <span class="comment">// after permission</span></span><br><span class="line">    afterPermission()</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    showRequestPermissionDialog(<span class="string">&quot;申请手机权限的原因是因为我需要&quot;</span>, Manifest.permission.READ_PHONE_STATE)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2 申请权限，根据合规化通常需要先弹框</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">showRequestPermissionDialog</span><span class="params">(message: <span class="type">String</span>, <span class="keyword">vararg</span> perm: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    AlertDialog.Builder(<span class="keyword">this</span>)</span><br><span class="line">        .setTitle(<span class="string">&quot;权限申请&quot;</span>)</span><br><span class="line">        .setMessage(message)</span><br><span class="line">        .setPositiveButton(<span class="string">&quot;去授权&quot;</span>) &#123; dialog, which -&gt;</span><br><span class="line">            dialog.dismiss()</span><br><span class="line">            PermissionManager.requestPermissions(<span class="keyword">this</span>, *perm)</span><br><span class="line">        &#125;</span><br><span class="line">        .setNegativeButton(<span class="string">&quot;取消&quot;</span>) &#123; dialog, which -&gt;</span><br><span class="line">            dialog.dismiss()</span><br><span class="line">            ToastUtil.showToast(<span class="keyword">this</span>, <span class="string">&quot;已取消授权...&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .setCancelable(<span class="literal">false</span>)</span><br><span class="line">        .create()</span><br><span class="line">        .show()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3 处理权限申请结果</p>
<p>在 <code>onRequestPermissionsResult</code> 回调接口中，调用 <code>PermissionManager.onRequestPermissionsResult</code> 方法，并且实现 <code>PermissionManager.OnPermissionResultCallback</code> 这个回调接口。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onRequestPermissionsResult</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    requestCode: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    permissions: <span class="type">Array</span>&lt;<span class="type">out</span> <span class="type">String</span>&gt;,</span></span></span><br><span class="line"><span class="params"><span class="function">    grantResults: <span class="type">IntArray</span></span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults)</span><br><span class="line">    PermissionManager.onRequestPermissionsResult(</span><br><span class="line">        <span class="keyword">this</span>,</span><br><span class="line">        requestCode,</span><br><span class="line">        permissions,</span><br><span class="line">        grantResults,</span><br><span class="line">        <span class="keyword">this</span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPermissionsGranted</span><span class="params">(requestCode: <span class="type">Int</span>, perms: <span class="type">List</span>&lt;<span class="type">String</span>?&gt;)</span></span> &#123;</span><br><span class="line">    ToastUtil.showToast(<span class="keyword">this</span>, <span class="string">&quot;授权成功&quot;</span>)</span><br><span class="line">    afterPermission()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPermissionsDenied</span><span class="params">(requestCode: <span class="type">Int</span>, perms: <span class="type">List</span>&lt;<span class="type">String</span>?&gt;)</span></span> &#123;</span><br><span class="line">    ToastUtil.showToast(<span class="keyword">this</span>, <span class="string">&quot;授权失败&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPermissionDeniedForever</span><span class="params">(requestCode: <span class="type">Int</span>, perms: <span class="type">List</span>&lt;<span class="type">String</span>?&gt;)</span></span> &#123;</span><br><span class="line">    showSettingsDialog()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4 当用户‘拒绝且不再询问’，引导去手机设置</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">showSettingsDialog</span><span class="params">()</span></span> &#123;</span><br><span class="line">    AlertDialog.Builder(<span class="keyword">this</span>)</span><br><span class="line">        .setTitle(<span class="string">&quot;权限申请&quot;</span>)</span><br><span class="line">        .setMessage(<span class="string">&quot;已永久拒绝，需要去设置-&gt;权限设置打开&quot;</span>)</span><br><span class="line">        .setPositiveButton(<span class="string">&quot;前往设置&quot;</span>) &#123; dialog, which -&gt;</span><br><span class="line">            dialog.dismiss()</span><br><span class="line">            <span class="keyword">val</span> intent = Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS)</span><br><span class="line">                .setData(Uri.fromParts(<span class="string">&quot;package&quot;</span>, packageName, <span class="literal">null</span>))</span><br><span class="line">            startActivityForResult(intent, REQUEST_CODE_FOR_PERMISSION_SETTINGS)</span><br><span class="line">        &#125;</span><br><span class="line">        .setNegativeButton(<span class="string">&quot;取消&quot;</span>) &#123; dialog, which -&gt;</span><br><span class="line">            dialog.dismiss()</span><br><span class="line">            ToastUtil.showToast(<span class="keyword">this</span>, <span class="string">&quot;已取消授权...&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .setCancelable(<span class="literal">false</span>)</span><br><span class="line">        .create()</span><br><span class="line">        .show()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5 检查手机设置后的权限申请结果</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityResult</span><span class="params">(requestCode: <span class="type">Int</span>, resultCode: <span class="type">Int</span>, <span class="keyword">data</span>: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (requestCode == REQUEST_CODE_FOR_PERMISSION_SETTINGS) &#123;</span><br><span class="line">        afterPermission()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, <span class="keyword">data</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="0x04-特别推荐-PermissionX"><a href="#0x04-特别推荐-PermissionX" class="headerlink" title="0x04 特别推荐 PermissionX"></a>0x04 特别推荐 <code>PermissionX</code></h4><p><a target="_blank" rel="noopener" href="https://github.com/guolindev/PermissionX">PermissionX</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/sinyu890807/category_10108528.html">中文文档</a></p>
<p>PermissionX is an extension Android library that makes Android runtime permission request extremely easy. You can use it for basic permission request occasions or handle more complex conditions, like showing rationale dialog or go to app settings for allowance manually.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-09-08T13:09:31.000Z" title="2022-9-8 9:09:31 ├F10: PM┤">2022-09-08</time>发表</span><span class="level-item">4 分钟读完 (大约654个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/2022/09/08/Android%E4%BB%8E%E7%8E%B0%E6%9C%89%E7%9A%84%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%9A%AE%E5%BA%94%E7%94%A8/">Android从现有的项目创建一个皮应用</a></p><div class="content"><h2 id="Android从现有的项目创建一个皮应用"><a href="#Android从现有的项目创建一个皮应用" class="headerlink" title="Android从现有的项目创建一个皮应用"></a>Android从现有的项目创建一个皮应用</h2><h3 id="0x01-Copy一个新项目"><a href="#0x01-Copy一个新项目" class="headerlink" title="0x01 Copy一个新项目"></a>0x01 Copy一个新项目</h3><ol>
<li>clean原项目，然后直接Copy原项目所有文件，等待完成</li>
<li>根据新项目重命名新文件夹名称</li>
<li>删除原项目的 <code>.idea</code> <code>.git</code> <code>.gitlab</code> 等文件夹，<code>.gradle</code> 可以不删</li>
<li>用编辑器打开 <code>settings.gradle</code>，修改项目名称 <code>rootProject.name = &quot;xxx&quot;</code></li>
</ol>
<h3 id="0x02-重命名项目包名"><a href="#0x02-重命名项目包名" class="headerlink" title="0x02 重命名项目包名"></a>0x02 重命名项目包名</h3><p>这一步是要将包名从 <code>com.sample1.android</code> 重命名为 <code>com.sample2.android</code></p>
<ol>
<li>用AndroidStudio打开新项目，去掉 <code>Compat Middle Packages</code> 前面的勾</li>
<li>选择项目的 <code>sample1</code> 包名，<code>Shift + F6</code>重命名</li>
<li>一定选择 <code>Rename Package</code></li>
<li>等待完成，项目大时间就比较长</li>
<li>修改 <code>.aidl</code> 文件的包名路径和import的路径</li>
<li>修改根目录下的 <code>build.gradle</code> 的 <code>applicationId &quot;com.sample2.android&quot;</code>，并 <code>sync</code></li>
</ol>
<p>ps: 不清楚为啥Kotlin的扩展函数还需要重新手动导入</p>
<h3 id="0x03-推到代码库"><a href="#0x03-推到代码库" class="headerlink" title="0x03 推到代码库"></a>0x03 推到代码库</h3><p>到上面这一步，不出意外的话已经可以编译成功并且跑起来了。编译成功之后可以先推送本地项目到代码库。</p>
<p>远程代码库新建项目，获取新项目git地址，然后执行下面操作。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> existing_folder</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git init</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git remote add origin git://github.com/schacon/grit.git</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git add .</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git commit</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git push -u origin master</span></span><br></pre></td></tr></table></figure>

<h3 id="0x04-后续"><a href="#0x04-后续" class="headerlink" title="0x04 后续"></a>0x04 后续</h3><p>下面就是修改名称，URL，替换功能啥的。</p>
<ul>
<li>Logo、名称、资源文件替换</li>
<li>H5协议替换</li>
<li>域名修改</li>
<li>第三方账号切换</li>
</ul>
<h3 id="0x05-审核相关"><a href="#0x05-审核相关" class="headerlink" title="0x05 审核相关"></a>0x05 审核相关</h3><p>现在应用市场对新应用的审核非常严格。为了过审，可能需要做很多相关的工作</p>
<ul>
<li>混淆，或者改文件名</li>
<li>资源混淆，或者资源改名</li>
<li>增加新功能</li>
<li>修改UI界面样式</li>
<li>做审核版功能</li>
</ul>
<h3 id="0x06-问题"><a href="#0x06-问题" class="headerlink" title="0x06 问题"></a>0x06 问题</h3><h4 id="0x0601-如果Shift-F6重命名时没有Rename-Package选项"><a href="#0x0601-如果Shift-F6重命名时没有Rename-Package选项" class="headerlink" title="0x0601 如果Shift + F6重命名时没有Rename Package选项"></a>0x0601 如果<code>Shift + F6</code>重命名时没有<code>Rename Package</code>选项</h4><p>如果<code>Shift + F6</code>重命名时没有<code>Rename Package</code>选项, 并且出现了以下提示，<br><code>Package &#39;example&#39; contains directories in libraries which cannot be renamed. Do you want to rename current directory or all directories in project?</code>，<br>这是因为依赖包中也存在example这个包名，导致无法直接重命名包名。解决的方案分两种：</p>
<p>方案1. 暂时先移除包含example包名的依赖包，等重命名之后重新添加到项目中<br>方案2. 只能新建package，然后将要rename的包拖动到新的package中，或者<code>F6</code>移动</p>
<p>PS：因为无法重命名，刚刚经历了手动移动十几个module的package包路径的痛苦历程。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-08-15T15:38:52.000Z" title="2022-8-15 11:38:52 ├F10: PM┤">2022-08-15</time>发表</span><span class="level-item">1 分钟读完 (大约216个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/blog/2022/08/15/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-RoundImageView/">RoundImageView圆角控件</a></p><div class="content"><h2 id="RoundImageView圆角控件"><a href="#RoundImageView圆角控件" class="headerlink" title="RoundImageView圆角控件"></a>RoundImageView圆角控件</h2><p>示例代码如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.res.TypedArray;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Canvas;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Path;</span><br><span class="line"><span class="keyword">import</span> android.graphics.RectF;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.<span class="keyword">annotation</span>.Nullable;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.widget.AppCompatImageView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoundImageView</span> <span class="title">extends</span> <span class="title">AppCompatImageView</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> static <span class="keyword">final</span> String TAG = <span class="string">&quot;RoundImageView&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> int radius = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> RoundImageView(Context context) &#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> RoundImageView(Context context, <span class="meta">@Nullable</span> AttributeSet attrs) &#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> RoundImageView(Context context, <span class="meta">@Nullable</span> AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        setup(context, attrs, defStyleAttr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> void setup(Context context, AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TypedArray a = context.obtainStyledAttributes(attrs, R.styleable.RoundImageView);</span><br><span class="line">            radius = a.getDimensionPixelSize(R.styleable.RoundImageView_riv_radius, <span class="number">0</span>);</span><br><span class="line">            Log.d(TAG, <span class="string">&quot;RoundImageView: radius=&quot;</span> + radius);</span><br><span class="line">            a.recycle();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> void setRadius(int radius) &#123;</span><br><span class="line">        <span class="keyword">this</span>.radius = radius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onDraw(Canvas canvas) &#123;</span><br><span class="line">        <span class="keyword">if</span> (radius &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            Path path = new Path();</span><br><span class="line">            path.addRoundRect(new RectF(<span class="number">0</span>, <span class="number">0</span>, getWidth(), getHeight()), radius, radius, Path.Direction.CW);</span><br><span class="line">            canvas.clipPath(path);<span class="comment">//设置可显示的区域，canvas四个角会被剪裁掉</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(canvas);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在 <code>attrs.xml</code> 文件中定义控件的圆角dp值属性:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">declare-styleable</span> <span class="attr">name</span>=<span class="string">&quot;RoundImageView&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;riv_radius&quot;</span> <span class="attr">format</span>=<span class="string">&quot;dimension&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">declare-styleable</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用示例</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">com.xx.ui.widget.RoundImageView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/image_view&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;120dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;60dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:scaleType</span>=<span class="string">&quot;centerCrop&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:riv_radius</span>=<span class="string">&quot;8dp&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/blog/">上一页</a></div><div class="pagination-next"><a href="/blog/page/3/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/blog/">1</a></li><li><a class="pagination-link is-current" href="/blog/page/2/">2</a></li><li><a class="pagination-link" href="/blog/page/3/">3</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/blog/page/14/">14</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/blog/img/avatar.png" alt="PPOffice"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">PPOffice</p><p class="is-size-6 is-block">Web Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Earth, Solar System</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/blog/archives"><p class="title">82</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/blog/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/blog/tags"><p class="title">26</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ppoffice" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ppoffice"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/blog/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><!--!--><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-03-25T13:00:07.184Z">2023-03-25</time></p><p class="title"><a href="/blog/2023/03/25/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-Aria%E4%B8%8B%E8%BD%BD%E5%99%A8/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-03-23T17:08:08.000Z">2023-03-24</time></p><p class="title"><a href="/blog/2023/03/24/RecyclerView%E6%BB%9A%E5%8A%A8%E5%88%B0%E6%8C%87%E5%AE%9Aitem%E5%B9%B6%E7%BD%AE%E9%A1%B6/">RecyclerView滑动到指定Item并置顶</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-03-16T14:05:48.000Z">2023-03-16</time></p><p class="title"><a href="/blog/2023/03/16/ExoPlayer%E7%AE%80%E6%98%93%E6%92%AD%E6%94%BE%E5%99%A8/">ExoPlayer简易播放器</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-02-15T12:29:00.000Z">2023-02-15</time></p><p class="title"><a href="/blog/2023/02/15/%E5%B7%A5%E5%85%B7%E7%B1%BB-SystemBarUtil/">SystemBarUtil 工具类</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-01-30T17:52:47.000Z">2023-01-31</time></p><p class="title"><a href="/blog/2023/01/31/%E7%9B%91%E6%8E%A7%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81/">Android 13 监控网络连接状态</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/blog/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/blog/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/blog/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">26</span></span></a></li><li><a class="level is-mobile" href="/blog/archives/2020/"><span class="level-start"><span class="level-item">2020</span></span><span class="level-end"><span class="level-item tag">33</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/blog/tags/Android/"><span class="tag">Android</span><span class="tag">53</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/ExoPlayer/"><span class="tag">ExoPlayer</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/Git/"><span class="tag">Git</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/Gradle/"><span class="tag">Gradle</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/Gson/"><span class="tag">Gson</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/H5/"><span class="tag">H5</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/Homebrew/"><span class="tag">Homebrew</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/Java/"><span class="tag">Java</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/JsBridge/"><span class="tag">JsBridge</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/Kotlin/"><span class="tag">Kotlin</span><span class="tag">15</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/Netty/"><span class="tag">Netty</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/NexT/"><span class="tag">NexT</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/Problems%E4%B8%93%E9%A2%98/"><span class="tag">Problems专题</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/Proxy/"><span class="tag">Proxy</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/Python/"><span class="tag">Python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/Reading/"><span class="tag">Reading</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/RecyclerView/"><span class="tag">RecyclerView</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/SSH/"><span class="tag">SSH</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/Shell/"><span class="tag">Shell</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/Shortcuts/"><span class="tag">Shortcuts</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/Vim/"><span class="tag">Vim</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/adb/"><span class="tag">adb</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/iTerm2/"><span class="tag">iTerm2</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/%E6%BA%90%E7%A0%81/"><span class="tag">源码</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog/tags/%E7%AE%97%E6%B3%95/"><span class="tag">算法</span><span class="tag">5</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/blog/"><img src="/blog/img/logo.svg" alt="个人小站" height="28"></a><p class="is-size-7"><span>&copy; 2023 Dench</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Discuss on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus/discussions"><i class="fas fa-comments"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/blog/js/column.js"></script><script src="/blog/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/blog/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><!--!--><!--!--><script src="/blog/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/blog/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/blog/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>