<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://denchopen.github.io/blog').hostname,
    root: '/blog/',
    scheme: 'Gemini',
    version: '7.7.1',
    exturl: false,
    sidebar: {"enable":true,"position":"left","width":280,"display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="Love &amp; Peace">
<meta property="og:type" content="website">
<meta property="og:title" content="个人小站">
<meta property="og:url" content="https://denchopen.github.io/blog/page/5/index.html">
<meta property="og:site_name" content="个人小站">
<meta property="og:description" content="Love &amp; Peace">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Dench">
<meta property="article:tag" content="Android">
<meta property="article:tag" content=" hexo">
<meta property="article:tag" content=" NexT">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://denchopen.github.io/blog/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>个人小站</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/blog/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">个人小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Dench's</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/DenchOpen" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://denchopen.github.io/blog/2021/05/25/Android%E4%B8%93%E6%A0%8F-BaseQuickAdapterHelper/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.png">
      <meta itemprop="name" content="Dench">
      <meta itemprop="description" content="Love & Peace">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人小站">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2021/05/25/Android%E4%B8%93%E6%A0%8F-BaseQuickAdapterHelper/" class="post-title-link" itemprop="url">Android专栏-BaseQuickAdapterHelper</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-25 22:38:52" itemprop="dateCreated datePublished" datetime="2021-05-25T22:38:52+08:00">2021-05-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-08 01:31:32" itemprop="dateModified" datetime="2021-12-08T01:31:32+08:00">2021-12-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Android专栏-BaseQuickAdapterHelper"><a href="#Android专栏-BaseQuickAdapterHelper" class="headerlink" title="Android专栏-BaseQuickAdapterHelper"></a>Android专栏-BaseQuickAdapterHelper</h2><h3 id="0x01-自动加载更多-LoadingFooterView"><a href="#0x01-自动加载更多-LoadingFooterView" class="headerlink" title="0x01 自动加载更多-LoadingFooterView"></a>0x01 自动加载更多-LoadingFooterView</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.view.View</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup</span><br><span class="line"><span class="keyword">import</span> com.chad.library.adapter.base.loadmore.BaseLoadMoreView</span><br><span class="line"><span class="keyword">import</span> com.chad.library.adapter.base.loadmore.LoadMoreStatus</span><br><span class="line"><span class="keyword">import</span> com.chad.library.adapter.base.util.getItemView</span><br><span class="line"><span class="keyword">import</span> com.chad.library.adapter.base.viewholder.BaseViewHolder</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoadingFooterView</span> : <span class="type">BaseLoadMoreView</span></span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> loadingView: LoadingPagView? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getRootView</span><span class="params">(parent: <span class="type">ViewGroup</span>)</span></span>: View &#123;</span><br><span class="line">        <span class="keyword">val</span> rootView = parent.getItemView(R.layout.ui_footer_adapter_load_more)</span><br><span class="line">        loadingView = rootView.findViewById(R.id.loadingView)</span><br><span class="line">        <span class="keyword">return</span> rootView</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getLoadingView</span><span class="params">(holder: <span class="type">BaseViewHolder</span>)</span></span>: View &#123;</span><br><span class="line">        <span class="keyword">return</span> holder.getView(R.id.loadingView)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getLoadComplete</span><span class="params">(holder: <span class="type">BaseViewHolder</span>)</span></span>: View &#123;</span><br><span class="line">        <span class="keyword">return</span> holder.getView(R.id.fakeView)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getLoadEndView</span><span class="params">(holder: <span class="type">BaseViewHolder</span>)</span></span>: View &#123;</span><br><span class="line">        <span class="keyword">return</span> holder.getView(R.id.endView)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getLoadFailView</span><span class="params">(holder: <span class="type">BaseViewHolder</span>)</span></span>: View &#123;</span><br><span class="line">        <span class="keyword">return</span> holder.getView(R.id.fakeView)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">convert</span><span class="params">(holder: <span class="type">BaseViewHolder</span>, position: <span class="type">Int</span>, loadMoreStatus: <span class="type">LoadMoreStatus</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.convert(holder, position, loadMoreStatus)</span><br><span class="line">        <span class="keyword">when</span> (loadMoreStatus) &#123;</span><br><span class="line">            LoadMoreStatus.Complete -&gt; &#123;</span><br><span class="line">                loadingView?.stopPlay()</span><br><span class="line">            &#125;</span><br><span class="line">            LoadMoreStatus.Loading -&gt; &#123;</span><br><span class="line">                loadingView?.startPlay()</span><br><span class="line">            &#125;</span><br><span class="line">            LoadMoreStatus.Fail -&gt; &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            LoadMoreStatus.End -&gt; &#123;</span><br><span class="line">                loadingView?.stopPlay()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://denchopen.github.io/blog/2021/05/24/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-VolumeDialog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.png">
      <meta itemprop="name" content="Dench">
      <meta itemprop="description" content="Love & Peace">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人小站">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2021/05/24/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-VolumeDialog/" class="post-title-link" itemprop="url">VolumeDialog音量控制自定义</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-24 23:38:52" itemprop="dateCreated datePublished" datetime="2021-05-24T23:38:52+08:00">2021-05-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-08 01:31:32" itemprop="dateModified" datetime="2021-12-08T01:31:32+08:00">2021-12-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="VolumeDialog音量控制自定义"><a href="#VolumeDialog音量控制自定义" class="headerlink" title="VolumeDialog音量控制自定义"></a>VolumeDialog音量控制自定义</h3><p>1 使用自定义 AlertDialog 实现</p>
<p>2 <code>window?.setFlags</code> 设置 dialog 的样式</p>
<p>3 <code>window?.attributes</code> 设置 dialog 的位置</p>
<p>4 返回键监听，兼容机型需要使用 setOnKeyListener</p>
<p>5 按一次音量键回调多次的问题，<code>KeyEvent.action</code> 事件分 KeyEvent.ACTION_UP 和 KeyEvent.ACTION_DOWN</p>
<p>6 音量加减需要获取系统音量 max 值来手动控制，不同手机 max 值域不同</p>
<p>示例代码如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.app.Activity</span><br><span class="line"><span class="keyword">import</span> android.content.Context</span><br><span class="line"><span class="keyword">import</span> android.content.res.Resources</span><br><span class="line"><span class="keyword">import</span> android.media.AudioManager</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle</span><br><span class="line"><span class="keyword">import</span> android.os.Handler</span><br><span class="line"><span class="keyword">import</span> android.os.Looper</span><br><span class="line"><span class="keyword">import</span> android.util.Log</span><br><span class="line"><span class="keyword">import</span> android.util.TypedValue</span><br><span class="line"><span class="keyword">import</span> android.view.Gravity</span><br><span class="line"><span class="keyword">import</span> android.view.KeyEvent</span><br><span class="line"><span class="keyword">import</span> android.view.WindowManager</span><br><span class="line"><span class="keyword">import</span> android.widget.ProgressBar</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AlertDialog</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 声音调整控件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VolumeDialog</span></span>(activity: Activity) : AlertDialog(activity, R.style.VolumeDialog) &#123;</span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> TAG = <span class="string">"VolumeDialog"</span></span><br><span class="line"></span><br><span class="line">        <span class="meta">@JvmStatic</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">show</span><span class="params">(activity: <span class="type">Activity</span>)</span></span> &#123;</span><br><span class="line">            activity.let &#123;</span><br><span class="line">                <span class="keyword">if</span> (activity.isFinishing) <span class="keyword">return</span></span><br><span class="line">                VolumeDialog(activity).show()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> volumeAudioManager = context.getSystemService(Context.AUDIO_SERVICE) <span class="keyword">as</span> AudioManager</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> volume = volumeAudioManager.getStreamVolume(AudioManager.STREAM_MUSIC)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> maxVolume = volumeAudioManager.getStreamMaxVolume(AudioManager.STREAM_MUSIC)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> step = (maxVolume / <span class="number">10</span>).coerceAtLeast(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> delayMillis = <span class="number">1500L</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.dialog_volume_progress)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//实现Dialog区域外部事件可以传给Activity</span></span><br><span class="line">        <span class="comment">// FLAG_NOT_TOUCH_MODAL作用：即使该window可获得焦点情况下，仍把该window之外的任何event发送到该window之后的其他window</span></span><br><span class="line">        window?.setFlags(</span><br><span class="line">            WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL,</span><br><span class="line">            WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment">// FLAG_WATCH_OUTSIDE_TOUCH作用：如果点击事件发生在window之外，就会收到一个特殊的MotionEvent，为ACTION_OUTSIDE</span></span><br><span class="line">        window?.setFlags(</span><br><span class="line">            WindowManager.LayoutParams.FLAG_WATCH_OUTSIDE_TOUCH,</span><br><span class="line">            WindowManager.LayoutParams.FLAG_WATCH_OUTSIDE_TOUCH</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 顶部显示</span></span><br><span class="line">        <span class="comment">//        window?.setGravity(Gravity.TOP)</span></span><br><span class="line">        <span class="keyword">val</span> attrs = window?.attributes</span><br><span class="line">        attrs?.apply &#123;</span><br><span class="line">            gravity = Gravity.TOP</span><br><span class="line">            height = WindowManager.LayoutParams.WRAP_CONTENT</span><br><span class="line">            width = WindowManager.LayoutParams.MATCH_PARENT</span><br><span class="line">            y = TypedValue.applyDimension(</span><br><span class="line">                TypedValue.COMPLEX_UNIT_DIP,</span><br><span class="line">                <span class="number">35f</span>,</span><br><span class="line">                Resources.getSystem().displayMetrics</span><br><span class="line">            ).toInt()</span><br><span class="line">        &#125;</span><br><span class="line">        Log.d(TAG, <span class="string">"onCreate() called with: attrs = <span class="variable">$attrs</span>"</span>)</span><br><span class="line">        window?.attributes = attrs</span><br><span class="line">        <span class="comment">// 按空白处不能取消</span></span><br><span class="line">        setCanceledOnTouchOutside(<span class="literal">false</span>)</span><br><span class="line">        <span class="comment">// 初始化界面控件</span></span><br><span class="line">        initView()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> volumeProgressView: VolumeProgressView? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> progressBar: ProgressBar? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> _handler = Handler(Looper.getMainLooper())</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> r = Runnable &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            dismiss()</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">            <span class="comment">// sometimes happens windows token error.</span></span><br><span class="line">            e.printStackTrace()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">dismiss</span><span class="params">()</span></span> &#123;</span><br><span class="line">        _handler.removeCallbacks(r)</span><br><span class="line">        <span class="keyword">super</span>.dismiss()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">initView</span><span class="params">()</span></span> &#123;</span><br><span class="line">        Log.d(TAG, <span class="string">"initView: "</span>)</span><br><span class="line">        volumeProgressView = findViewById(R.id.vpv_volume)</span><br><span class="line">        progressBar = findViewById(R.id.pb_volume)</span><br><span class="line"></span><br><span class="line">        refreshProgress(volume * <span class="number">1f</span> / maxVolume)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解决不同机型版本兼容问题，onKeyDown 可能被拦截</span></span><br><span class="line">        setOnKeyListener &#123; _, keyCode, event -&gt;</span><br><span class="line">          Log.d(TAG, <span class="string">"setOnKeyListener: keyCode = <span class="variable">$keyCode</span>, event = <span class="variable">$event</span>"</span>)</span><br><span class="line">          <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_VOLUME_UP || keyCode == KeyEvent.KEYCODE_VOLUME_DOWN) &#123;</span><br><span class="line">              handleKeyEvent(keyCode, event)</span><br><span class="line">              <span class="literal">true</span></span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">refreshProgress</span><span class="params">(volumePercent: <span class="type">Float</span>)</span></span> &#123;</span><br><span class="line">        _handler.removeCallbacks(r)</span><br><span class="line">        volumeProgressView?.setProgress(volumePercent)</span><br><span class="line">        progressBar?.progress = (volumePercent * <span class="number">1000</span>).toInt()</span><br><span class="line">        _handler.postDelayed(r, delayMillis)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">handleKeyEvent</span><span class="params">(keyCode: <span class="type">Int</span>, event: <span class="type">KeyEvent</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        Log.d(TAG, <span class="string">"handleKeyEvent: volume = <span class="variable">$volume</span>, maxVolume = <span class="variable">$maxVolume</span>, step = <span class="variable">$step</span>"</span>)</span><br><span class="line">        <span class="keyword">if</span> ((keyCode != KeyEvent.KEYCODE_VOLUME_UP &amp;&amp; keyCode != KeyEvent.KEYCODE_VOLUME_DOWN) || event.action != KeyEvent.ACTION_DOWN) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        volume = <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_VOLUME_UP) &#123; <span class="comment">// up</span></span><br><span class="line">            <span class="keyword">if</span> (volume == maxVolume) <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            maxVolume.coerceAtMost(volume + step)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// down</span></span><br><span class="line">            <span class="keyword">if</span> (volume == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            <span class="number">0</span>.coerceAtLeast(volume - step)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> volumePercent = volume * <span class="number">1f</span> / maxVolume</span><br><span class="line">        refreshProgress(volumePercent)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 变更声音</span></span><br><span class="line">        volumeAudioManager.setStreamVolume(AudioManager.STREAM_MUSIC, volume, <span class="number">0</span>)</span><br><span class="line">        Log.d(TAG, <span class="string">"handleKeyEvent: AudioManager set volume = <span class="variable">$volume</span> done."</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回事件，仅拦截音量控制事件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onKeyDown</span><span class="params">(keyCode: <span class="type">Int</span>, event: <span class="type">KeyEvent</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        Log.d(TAG, <span class="string">"onKeyDown() called with: keyCode = <span class="variable">$keyCode</span>, event = <span class="variable">$event</span>"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_VOLUME_UP || keyCode == KeyEvent.KEYCODE_VOLUME_DOWN) &#123;</span><br><span class="line">            handleKeyEvent(keyCode, event)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">super</span>.onKeyDown(keyCode, event)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自定义Dialog的Style</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"VolumeDialog"</span> <span class="attr">parent</span>=<span class="string">"android:style/Theme.Dialog"</span>&gt;</span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!--背景颜色及和透明程度--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowBackground"</span>&gt;</span>@android:color/transparent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!--是否去除标题 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowNoTitle"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!--是否去除边框--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowFrame"</span>&gt;</span>@null<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!--是否浮现在activity之上--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowIsFloating"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!--是否模糊--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:backgroundDimEnabled"</span>&gt;</span>false<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://denchopen.github.io/blog/2021/05/21/MessageCenter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.png">
      <meta itemprop="name" content="Dench">
      <meta itemprop="description" content="Love & Peace">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人小站">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2021/05/21/MessageCenter/" class="post-title-link" itemprop="url">观察者模式Kotlin泛型实现消息中心</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-05-21 22:57:15 / 修改时间：23:07:50" itemprop="dateCreated datePublished" datetime="2021-05-21T22:57:15+08:00">2021-05-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>观察者模式 + Kotlin 泛型实现的简易版消息中心</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MessageCenter</span>&lt;<span class="type">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> centers = mutableMapOf&lt;String, Any&gt;()</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> <span class="title">getInstance</span><span class="params">(clazz: <span class="type">Class</span>&lt;<span class="type">T</span>&gt;)</span></span>: MessageCenter&lt;T&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">if</span> (centers[clazz.simpleName] != <span class="literal">null</span>) &#123;</span><br><span class="line">        centers[clazz.simpleName] <span class="keyword">as</span> MessageCenter&lt;T&gt;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> messageCenter = MessageCenter&lt;T&gt;()</span><br><span class="line">        centers[clazz.simpleName] = messageCenter</span><br><span class="line">        messageCenter</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">register</span><span class="params">(observer: <span class="type">Observer</span>&lt;<span class="type">T</span>&gt;)</span></span> &#123;</span><br><span class="line">    observers.add(observer)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">unregister</span><span class="params">(observer: <span class="type">Observer</span>&lt;<span class="type">T</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (observers.contains(observer)) &#123;</span><br><span class="line">      observers.remove(observer)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">post</span><span class="params">(t: <span class="type">T</span>)</span></span> &#123;</span><br><span class="line">    observers.forEach &#123;</span><br><span class="line">      it.receive(t)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">var</span> observers = mutableListOf&lt;Observer&lt;T&gt;&gt;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Observer</span>&lt;<span class="type">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">receive</span><span class="params">(t: <span class="type">T</span>)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">val</span> ob = <span class="keyword">object</span> : Observer&lt;String&gt; &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">receive</span><span class="params">(t: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">      println(<span class="string">"result is: <span class="variable">$t</span>"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  MessageCenter.getInstance(String::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>).<span class="title">register</span></span>(ob)</span><br><span class="line">  MessageCenter.getInstance(String::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>).<span class="title">post</span></span>(<span class="string">"txt post."</span>)</span><br><span class="line">  MessageCenter.getInstance(String::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>).<span class="title">unregister</span></span>(ob)</span><br><span class="line"></span><br><span class="line">  MessageCenter.getInstance(<span class="built_in">Int</span>::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>).<span class="title">post</span></span>(<span class="number">123</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://denchopen.github.io/blog/2021/05/19/BottomFragment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.png">
      <meta itemprop="name" content="Dench">
      <meta itemprop="description" content="Love & Peace">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人小站">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2021/05/19/BottomFragment/" class="post-title-link" itemprop="url">BottomFragment</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-19 02:16:30" itemprop="dateCreated datePublished" datetime="2021-05-19T02:16:30+08:00">2021-05-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-21 23:09:32" itemprop="dateModified" datetime="2021-05-21T23:09:32+08:00">2021-05-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="底部弹出控件-Fragment-实现"><a href="#底部弹出控件-Fragment-实现" class="headerlink" title="底部弹出控件 - Fragment 实现"></a>底部弹出控件 - Fragment 实现</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.os.Bundle</span><br><span class="line"><span class="keyword">import</span> android.util.Log</span><br><span class="line"><span class="keyword">import</span> android.view.LayoutInflater</span><br><span class="line"><span class="keyword">import</span> android.view.View</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup</span><br><span class="line"><span class="keyword">import</span> androidx.fragment.app.Fragment</span><br><span class="line"><span class="keyword">import</span> androidx.fragment.app.FragmentManager</span><br><span class="line"><span class="keyword">import</span> com.dench.baselib.R</span><br><span class="line"><span class="keyword">import</span> com.dench.baselib.databinding.FragmentBottomBinding</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BottomFragment</span> : <span class="type">Fragment</span></span>() &#123;</span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">start</span><span class="params">(fm: <span class="type">FragmentManager</span>, fragment: <span class="type">Fragment</span>)</span></span>: BottomFragment &#123;</span><br><span class="line">            <span class="keyword">val</span> bottomFragment = BottomFragment().apply &#123;</span><br><span class="line">                setFragment(fragment)</span><br><span class="line">            &#125;</span><br><span class="line">            fm.beginTransaction()</span><br><span class="line">                .setCustomAnimations(</span><br><span class="line">                    R.anim.fragment_bottom_enter,</span><br><span class="line">                    <span class="number">0</span>,</span><br><span class="line">                    <span class="number">0</span>,</span><br><span class="line">                    R.anim.fragment_bottom_exit</span><br><span class="line">                )</span><br><span class="line">                .add(android.R.id.content, bottomFragment)</span><br><span class="line">                .addToBackStack(<span class="literal">null</span>)</span><br><span class="line">                .commitAllowingStateLoss()</span><br><span class="line">            <span class="keyword">return</span> bottomFragment</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> fragment: Fragment</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">setFragment</span><span class="params">(fragment: <span class="type">Fragment</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.fragment = fragment</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> binding: FragmentBottomBinding</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> TAG = <span class="string">"BottomFragment"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateView</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        inflater: <span class="type">LayoutInflater</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        container: <span class="type">ViewGroup</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        savedInstanceState: <span class="type">Bundle</span>?</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>: View? &#123;</span><br><span class="line">        binding = FragmentBottomBinding.inflate(inflater, container, <span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">return</span> binding.root</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onViewCreated</span><span class="params">(view: <span class="type">View</span>, savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onViewCreated(view, savedInstanceState)</span><br><span class="line">        binding.run &#123;</span><br><span class="line">            binding.bottomFragmentRl.setOnClickListener(View.OnClickListener &#123;</span><br><span class="line">                Log.d(TAG, <span class="string">"bottom root view click."</span>)</span><br><span class="line">                dismissSelf()</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">            <span class="comment">/** add fragment */</span></span><br><span class="line">            childFragmentManager.beginTransaction()</span><br><span class="line">                .add(R.id.container, fragment)</span><br><span class="line">                .commitAllowingStateLoss()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">dismissSelf</span><span class="params">()</span></span> &#123;</span><br><span class="line">        parentFragmentManager.popBackStack()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://denchopen.github.io/blog/2020/12/29/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9Netty/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.png">
      <meta itemprop="name" content="Dench">
      <meta itemprop="description" content="Love & Peace">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人小站">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/12/29/%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9Netty/" class="post-title-link" itemprop="url">为什么选择Netty</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-12-29 01:21:23 / 修改时间：01:51:38" itemprop="dateCreated datePublished" datetime="2020-12-29T01:21:23+08:00">2020-12-29</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="为什么选择Netty"><a href="#为什么选择Netty" class="headerlink" title="为什么选择Netty"></a>为什么选择Netty</h2><p>Netty是业界最流行的NIO框架之一，它的健壮性、功能、性能、可定制性和可扩展性在同类框架中都是首屈一指的，它已经得到成百上千的商用项目验证，例如Hadoop的RPC框架Avro就使用了Netty作为底层通信框架，其他如Strom还有业界主流的RPC框架，也使用Netty来构建高性能的异步通信能力。</p>
<p>通过对Netty的分析，我们将它的优点总结如下。</p>
<p>◎    API使用简单，开发门槛低；</p>
<p>◎    功能强大，预置了多种编解码功能，支持多种主流协议；</p>
<p>◎    定制能力强，可以通过ChannelHandler对通信框架进行灵活地扩展；</p>
<p>◎    性能高，通过与其他业界主流的NIO框架对比，Netty的综合性能最优；</p>
<p>◎    成熟、稳定，Netty修复了已经发现的所有JDK NIO BUG，业务开发人员不需要再为NIO的BUG而烦恼；</p>
<p>◎    社区活跃，版本迭代周期短，发现的BUG可以被及时修复，同时，更多的新功能会加入；</p>
<p>◎    经历了大规模的商业应用考验，质量得到验证。Netty在互联网、大数据、网络游戏、企业应用、电信软件等众多行业已经得到了成功商用，证明它已经完全能够满足不同行业的商业应用了。</p>
<p>正是因为这些优点，Netty逐渐成为了Java NIO编程的首选框架。</p>
<h2 id="Netty-是什么？"><a href="#Netty-是什么？" class="headerlink" title="Netty 是什么？"></a>Netty 是什么？</h2><p><strong>那Netty到底是什么？官方解释：Netty 是一个异步事件驱动的网络应用框架，用于快速开发可维护的高性能服务器和客户端。Netty就是一个对Jdk的Nio进行封装的一个框架。</strong></p>
<p>Netty is <em>an asynchronous event-driven network application framework</em><br>for rapid development of maintainable high performance protocol servers &amp; clients.</p>
<p><a href="https://netty.io/" target="_blank" rel="noopener">https://netty.io/</a></p>
<p>在开始了解 Netty 是什么之前，我们先来回顾一下，如果我们需要实现一个客户端与服务端通信的程序，使用传统的 IO 编程，应该如何来实现？</p>
<h2 id="IO编程"><a href="#IO编程" class="headerlink" title="IO编程"></a>IO编程</h2><p>我们简化下场景：客户端每隔两秒发送一个带有时间戳的 “hello world” 给服务端，服务端收到之后打印。</p>
<p>为了方便演示，下面例子中，服务端和客户端各一个类，把这两个类拷贝到你的 IDE 中，先后运行 <code>IOServer.java</code> 和<code>IOClient.java</code>可看到效果。</p>
<p>下面是传统的 IO 编程中服务端实现</p>
<blockquote>
<p>IOServer.java</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * @author 闪电侠</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class IOServer &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        ServerSocket serverSocket &#x3D; new ServerSocket(8000);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; (1) 接收新连接线程</span><br><span class="line">        new Thread(() -&gt; &#123;</span><br><span class="line">            while (true) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    &#x2F;&#x2F; (1) 阻塞方法获取新的连接</span><br><span class="line">                    Socket socket &#x3D; serverSocket.accept();</span><br><span class="line"></span><br><span class="line">                    &#x2F;&#x2F; (2) 每一个新的连接都创建一个线程，负责读取数据</span><br><span class="line">                    new Thread(() -&gt; &#123;</span><br><span class="line">                        try &#123;</span><br><span class="line">                            int len;</span><br><span class="line">                            byte[] data &#x3D; new byte[1024];</span><br><span class="line">                            InputStream inputStream &#x3D; socket.getInputStream();</span><br><span class="line">                            &#x2F;&#x2F; (3) 按字节流方式读取数据</span><br><span class="line">                            while ((len &#x3D; inputStream.read(data)) !&#x3D; -1) &#123;</span><br><span class="line">                                System.out.println(new String(data, 0, len));</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; catch (IOException e) &#123;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;).start();</span><br><span class="line"></span><br><span class="line">                &#125; catch (IOException e) &#123;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Server 端首先创建了一个<code>serverSocket</code>来监听 8000 端口，然后创建一个线程，线程里面不断调用阻塞方法 <code>serversocket.accept();</code>获取新的连接，见(1)，当获取到新的连接之后，给每条连接创建一个新的线程，这个线程负责从该连接中读取数据，见(2)，然后读取数据是以字节流的方式，见(3)。</p>
<p>下面是传统的IO编程中客户端实现</p>
<blockquote>
<p>IOClient.java</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * @author 闪电侠</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class IOClient &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        new Thread(() -&gt; &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                Socket socket &#x3D; new Socket(&quot;127.0.0.1&quot;, 8000);</span><br><span class="line">                while (true) &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        socket.getOutputStream().write((new Date() + &quot;: hello world&quot;).getBytes());</span><br><span class="line">                        Thread.sleep(2000);</span><br><span class="line">                    &#125; catch (Exception e) &#123;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端的代码相对简单，连接上服务端 8000 端口之后，每隔 2 秒，我们向服务端写一个带有时间戳的 “hello world”。</p>
<p>IO 编程模型在客户端较少的情况下运行良好，但是对于客户端比较多的业务来说，单机服务端可能需要支撑成千上万的连接，IO 模型可能就不太合适了，我们来分析一下原因。</p>
<p>上面的 demo，从服务端代码中我们可以看到，在传统的 IO 模型中，每个连接创建成功之后都需要一个线程来维护，每个线程包含一个 while 死循环，那么 1w 个连接对应 1w 个线程，继而 1w 个 while 死循环，这就带来如下几个问题：</p>
<ol>
<li>线程资源受限：线程是操作系统中非常宝贵的资源，同一时刻有大量的线程处于阻塞状态是非常严重的资源浪费，操作系统耗不起</li>
<li>线程切换效率低下：单机 CPU 核数固定，线程爆炸之后操作系统频繁进行线程切换，应用性能急剧下降。</li>
<li>除了以上两个问题，IO 编程中，我们看到数据读写是以字节流为单位。</li>
</ol>
<p>为了解决这三个问题，JDK 在 1.4 之后提出了 NIO。</p>
<h2 id="NIO-编程"><a href="#NIO-编程" class="headerlink" title="NIO 编程"></a>NIO 编程</h2><p>关于 NIO 相关的文章网上也有很多，这里不打算详细深入分析，下面简单描述一下 NIO 是如何解决以上三个问题的。</p>
<h3 id="线程资源受限"><a href="#线程资源受限" class="headerlink" title="线程资源受限"></a>线程资源受限</h3><p>NIO 编程模型中，新来一个连接不再创建一个新的线程，而是可以把这条连接直接绑定到某个固定的线程，然后这条连接所有的读写都由这个线程来负责，那么他是怎么做到的？我们用一幅图来对比一下 IO 与 NIO</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/7/16/164a0874b7ccd652?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image.png"></p>
<p>如上图所示，IO 模型中，一个连接来了，会创建一个线程，对应一个 while 死循环，死循环的目的就是不断监测这条连接上是否有数据可以读，大多数情况下，1w 个连接里面同一时刻只有少量的连接有数据可读，因此，很多个 while 死循环都白白浪费掉了，因为读不出啥数据。</p>
<p>而在 NIO 模型中，他把这么多 while 死循环变成一个死循环，这个死循环由一个线程控制，那么他又是如何做到一个线程，一个 while 死循环就能监测1w个连接是否有数据可读的呢？ 这就是 NIO 模型中 selector 的作用，一条连接来了之后，现在不创建一个 while 死循环去监听是否有数据可读了，而是直接把这条连接注册到 selector 上，然后，通过检查这个 selector，就可以批量监测出有数据可读的连接，进而读取数据，下面我再举个非常简单的生活中的例子说明 IO 与 NIO 的区别。</p>
<p>在一家幼儿园里，小朋友有上厕所的需求，小朋友都太小以至于你要问他要不要上厕所，他才会告诉你。幼儿园一共有 100 个小朋友，有两种方案可以解决小朋友上厕所的问题：</p>
<ol>
<li>每个小朋友配一个老师。每个老师隔段时间询问小朋友是否要上厕所，如果要上，就领他去厕所，100 个小朋友就需要 100 个老师来询问，并且每个小朋友上厕所的时候都需要一个老师领着他去上，这就是IO模型，一个连接对应一个线程。</li>
<li>所有的小朋友都配同一个老师。这个老师隔段时间询问所有的小朋友是否有人要上厕所，然后每一时刻把所有要上厕所的小朋友批量领到厕所，这就是 NIO 模型，所有小朋友都注册到同一个老师，对应的就是所有的连接都注册到一个线程，然后批量轮询。</li>
</ol>
<p>这就是 NIO 模型解决线程资源受限的方案，实际开发过程中，我们会开多个线程，每个线程都管理着一批连接，相对于 IO 模型中一个线程管理一条连接，消耗的线程资源大幅减少</p>
<h3 id="线程切换效率低下"><a href="#线程切换效率低下" class="headerlink" title="线程切换效率低下"></a>线程切换效率低下</h3><p>由于 NIO 模型中线程数量大大降低，线程切换效率因此也大幅度提高</p>
<h3 id="IO读写面向流"><a href="#IO读写面向流" class="headerlink" title="IO读写面向流"></a>IO读写面向流</h3><p>IO 读写是面向流的，一次性只能从流中读取一个或者多个字节，并且读完之后流无法再读取，你需要自己缓存数据。 而 NIO 的读写是面向 Buffer 的，你可以随意读取里面任何一个字节数据，不需要你自己缓存数据，这一切只需要移动读写指针即可。</p>
<p>简单讲完了 JDK NIO 的解决方案之后，我们接下来使用 NIO 的方案替换掉 IO 的方案，我们先来看看，如果用 JDK 原生的 NIO 来实现服务端，该怎么做</p>
<blockquote>
<p>前方高能预警：以下代码可能会让你感觉极度不适，如有不适，请跳过</p>
</blockquote>
<blockquote>
<p>NIOServer.java</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * @author 闪电侠</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class NIOServer &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException &#123;</span><br><span class="line">        Selector serverSelector &#x3D; Selector.open();</span><br><span class="line">        Selector clientSelector &#x3D; Selector.open();</span><br><span class="line"></span><br><span class="line">        new Thread(() -&gt; &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                &#x2F;&#x2F; 对应IO编程中服务端启动</span><br><span class="line">                ServerSocketChannel listenerChannel &#x3D; ServerSocketChannel.open();</span><br><span class="line">                listenerChannel.socket().bind(new InetSocketAddress(8000));</span><br><span class="line">                listenerChannel.configureBlocking(false);</span><br><span class="line">                listenerChannel.register(serverSelector, SelectionKey.OP_ACCEPT);</span><br><span class="line"></span><br><span class="line">                while (true) &#123;</span><br><span class="line">                    &#x2F;&#x2F; 监测是否有新的连接，这里的1指的是阻塞的时间为 1ms</span><br><span class="line">                    if (serverSelector.select(1) &gt; 0) &#123;</span><br><span class="line">                        Set&lt;SelectionKey&gt; set &#x3D; serverSelector.selectedKeys();</span><br><span class="line">                        Iterator&lt;SelectionKey&gt; keyIterator &#x3D; set.iterator();</span><br><span class="line"></span><br><span class="line">                        while (keyIterator.hasNext()) &#123;</span><br><span class="line">                            SelectionKey key &#x3D; keyIterator.next();</span><br><span class="line"></span><br><span class="line">                            if (key.isAcceptable()) &#123;</span><br><span class="line">                                try &#123;</span><br><span class="line">                                    &#x2F;&#x2F; (1) 每来一个新连接，不需要创建一个线程，而是直接注册到clientSelector</span><br><span class="line">                                    SocketChannel clientChannel &#x3D; ((ServerSocketChannel) key.channel()).accept();</span><br><span class="line">                                    clientChannel.configureBlocking(false);</span><br><span class="line">                                    clientChannel.register(clientSelector, SelectionKey.OP_READ);</span><br><span class="line">                                &#125; finally &#123;</span><br><span class="line">                                    keyIterator.remove();</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (IOException ignored) &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        new Thread(() -&gt; &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                while (true) &#123;</span><br><span class="line">                    &#x2F;&#x2F; (2) 批量轮询是否有哪些连接有数据可读，这里的1指的是阻塞的时间为 1ms</span><br><span class="line">                    if (clientSelector.select(1) &gt; 0) &#123;</span><br><span class="line">                        Set&lt;SelectionKey&gt; set &#x3D; clientSelector.selectedKeys();</span><br><span class="line">                        Iterator&lt;SelectionKey&gt; keyIterator &#x3D; set.iterator();</span><br><span class="line"></span><br><span class="line">                        while (keyIterator.hasNext()) &#123;</span><br><span class="line">                            SelectionKey key &#x3D; keyIterator.next();</span><br><span class="line"></span><br><span class="line">                            if (key.isReadable()) &#123;</span><br><span class="line">                                try &#123;</span><br><span class="line">                                    SocketChannel clientChannel &#x3D; (SocketChannel) key.channel();</span><br><span class="line">                                    ByteBuffer byteBuffer &#x3D; ByteBuffer.allocate(1024);</span><br><span class="line">                                    &#x2F;&#x2F; (3) 面向 Buffer</span><br><span class="line">                                    clientChannel.read(byteBuffer);</span><br><span class="line">                                    byteBuffer.flip();</span><br><span class="line">                                    System.out.println(Charset.defaultCharset().newDecoder().decode(byteBuffer)</span><br><span class="line">                                            .toString());</span><br><span class="line">                                &#125; finally &#123;</span><br><span class="line">                                    keyIterator.remove();</span><br><span class="line">                                    key.interestOps(SelectionKey.OP_READ);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (IOException ignored) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>相信大部分没有接触过 NIO 的同学应该会直接跳过代码来到这一行：原来使用 JDK 原生 NIO 的 API 实现一个简单的服务端通信程序是如此复杂!</p>
<p>复杂得我都没耐心解释这一坨代码的执行逻辑(开个玩笑)，我们还是先对照 NIO 来解释一下几个核心思路</p>
<ol>
<li>NIO 模型中通常会有两个线程，每个线程绑定一个轮询器 selector ，在我们这个例子中<code>serverSelector</code>负责轮询是否有新的连接，<code>clientSelector</code>负责轮询连接是否有数据可读</li>
<li>服务端监测到新的连接之后，不再创建一个新的线程，而是直接将新连接绑定到<code>clientSelector</code>上，这样就不用 IO 模型中 1w 个 while 循环在死等，参见(1)</li>
<li><code>clientSelector</code>被一个 while 死循环包裹着，如果在某一时刻有多条连接有数据可读，那么通过 <code>clientSelector.select(1)</code>方法可以轮询出来，进而批量处理，参见(2)</li>
<li>数据的读写面向 Buffer，参见(3)</li>
</ol>
<p>其他的细节部分，我不愿意多讲，因为实在是太复杂，你也不用对代码的细节深究到底。总之，强烈不建议直接基于JDK原生NIO来进行网络开发，下面是我总结的原因</p>
<ol>
<li>JDK 的 NIO 编程需要了解很多的概念，编程复杂，对 NIO 入门非常不友好，编程模型不友好，ByteBuffer 的 Api 简直反人类</li>
<li>对 NIO 编程来说，一个比较合适的线程模型能充分发挥它的优势，而 JDK 没有给你实现，你需要自己实现，就连简单的自定义协议拆包都要你自己实现</li>
<li>JDK 的 NIO 底层由 epoll 实现，该实现饱受诟病的空轮询 bug 会导致 cpu 飙升 100%</li>
<li>项目庞大之后，自行实现的 NIO 很容易出现各类 bug，维护成本较高，上面这一坨代码我都不能保证没有 bug</li>
</ol>
<p>正因为如此，我客户端代码都懒得写给你看了==!，你可以直接使用<code>IOClient.java</code>与<code>NIOServer.java</code>通信</p>
<p>JDK 的 NIO 犹如带刺的玫瑰，虽然美好，让人向往，但是使用不当会让你抓耳挠腮，痛不欲生，正因为如此，Netty 横空出世！</p>
<h2 id="Netty编程"><a href="#Netty编程" class="headerlink" title="Netty编程"></a>Netty编程</h2><p>那么 Netty 到底是何方神圣？ 用一句简单的话来说就是：Netty 封装了 JDK 的 NIO，让你用得更爽，你不用再写一大堆复杂的代码了。 用官方正式的话来说就是：Netty 是一个异步事件驱动的网络应用框架，用于快速开发可维护的高性能服务器和客户端。</p>
<p>下面是我总结的使用 Netty 不使用 JDK 原生 NIO 的原因</p>
<ol>
<li>使用 JDK 自带的NIO需要了解太多的概念，编程复杂，一不小心 bug 横飞</li>
<li>Netty 底层 IO 模型随意切换，而这一切只需要做微小的改动，改改参数，Netty可以直接从 NIO 模型变身为 IO 模型</li>
<li>Netty 自带的拆包解包，异常检测等机制让你从NIO的繁重细节中脱离出来，让你只需要关心业务逻辑</li>
<li>Netty 解决了 JDK 的很多包括空轮询在内的 Bug</li>
<li>Netty 底层对线程，selector 做了很多细小的优化，精心设计的 reactor 线程模型做到非常高效的并发处理</li>
<li>自带各种协议栈让你处理任何一种通用协议都几乎不用亲自动手</li>
<li>Netty 社区活跃，遇到问题随时邮件列表或者 issue</li>
<li>Netty 已经历各大 RPC 框架，消息中间件，分布式通信中间件线上的广泛验证，健壮性无比强大</li>
</ol>
<p>看不懂没有关系，这些我们在后续的课程中我们都可以学到，接下来我们用 Netty 的版本来重新实现一下本文开篇的功能吧</p>
<p>首先，引入 Maven 依赖，本文后续 Netty 都是基于 4.1.6.Final 版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.netty&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;netty-all&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.1.6.Final&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>然后，下面是服务端实现部分</p>
<blockquote>
<p>NettyServer.java</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * @author 闪电侠</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class NettyServer &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        ServerBootstrap serverBootstrap &#x3D; new ServerBootstrap();</span><br><span class="line"></span><br><span class="line">        NioEventLoopGroup boss &#x3D; new NioEventLoopGroup();</span><br><span class="line">        NioEventLoopGroup worker &#x3D; new NioEventLoopGroup();</span><br><span class="line">        serverBootstrap</span><br><span class="line">                .group(boss, worker)</span><br><span class="line">                .channel(NioServerSocketChannel.class)</span><br><span class="line">                .childHandler(new ChannelInitializer&lt;NioSocketChannel&gt;() &#123;</span><br><span class="line">                    protected void initChannel(NioSocketChannel ch) &#123;</span><br><span class="line">                        ch.pipeline().addLast(new StringDecoder());</span><br><span class="line">                        ch.pipeline().addLast(new SimpleChannelInboundHandler&lt;String&gt;() &#123;</span><br><span class="line">                            @Override</span><br><span class="line">                            protected void channelRead0(ChannelHandlerContext ctx, String msg) &#123;</span><br><span class="line">                                System.out.println(msg);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .bind(8000);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这么一小段代码就实现了我们前面 NIO 编程中的所有的功能，包括服务端启动，接受新连接，打印客户端传来的数据，怎么样，是不是比 JDK 原生的 NIO 编程优雅许多？</p>
<p>初学 Netty 的时候，由于大部分人对 NIO 编程缺乏经验，因此，将 Netty 里面的概念与 IO 模型结合起来可能更好理解</p>
<ol>
<li><code>boss</code> 对应 <code>IOServer.java</code> 中的接受新连接线程，主要负责创建新连接</li>
<li><code>worker</code> 对应 <code>IOServer.java</code> 中的负责读取数据的线程，主要用于读取数据以及业务逻辑处理</li>
</ol>
<p>然后剩下的逻辑我在后面的系列文章中会详细分析，你可以先把这段代码拷贝到你的 IDE 里面，然后运行 main 函数</p>
<p>然后下面是客户端 NIO 的实现部分</p>
<blockquote>
<p>NettyClient.java</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * @author 闪电侠</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class NettyClient &#123;</span><br><span class="line">    public static void main(String[] args) throws InterruptedException &#123;</span><br><span class="line">        Bootstrap bootstrap &#x3D; new Bootstrap();</span><br><span class="line">        NioEventLoopGroup group &#x3D; new NioEventLoopGroup();</span><br><span class="line"></span><br><span class="line">        bootstrap.group(group)</span><br><span class="line">                .channel(NioSocketChannel.class)</span><br><span class="line">                .handler(new ChannelInitializer&lt;Channel&gt;() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    protected void initChannel(Channel ch) &#123;</span><br><span class="line">                        ch.pipeline().addLast(new StringEncoder());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">        Channel channel &#x3D; bootstrap.connect(&quot;127.0.0.1&quot;, 8000).channel();</span><br><span class="line"></span><br><span class="line">        while (true) &#123;</span><br><span class="line">            channel.writeAndFlush(new Date() + &quot;: hello world!&quot;);</span><br><span class="line">            Thread.sleep(2000);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在客户端程序中，<code>group</code>对应了我们<code>IOClient.java</code>中 main 函数起的线程，剩下的逻辑我在后面的文章中会详细分析，现在你要做的事情就是把这段代码拷贝到你的 IDE 里面，然后运行 main 函数，最后回到 <code>NettyServer.java</code> 的控制台，你会看到效果。</p>
<p>使用 Netty 之后是不是觉得整个世界都美好了，一方面 Netty 对 NIO 封装得如此完美，写出来的代码非常优雅，另外一方面，使用 Netty 之后，网络通信这块的性能问题几乎不用操心，尽情地让 Netty 榨干你的 CPU 吧。</p>
<p>资料：<br>1、选择Netty作为基础通信框架 :<br><a href="https://www.cnblogs.com/mxyhws/p/5500425.html" target="_blank" rel="noopener">https://www.cnblogs.com/mxyhws/p/5500425.html</a></p>
<p>2、Nginx/Netty/ZeroMQ网络模型:</p>
<p><a href="https://blog.csdn.net/kobejayandy/article/details/20294909" target="_blank" rel="noopener">https://blog.csdn.net/kobejayandy/article/details/20294909</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://denchopen.github.io/blog/2020/12/26/Android%E4%B8%93%E6%A0%8F-WebView/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.png">
      <meta itemprop="name" content="Dench">
      <meta itemprop="description" content="Love & Peace">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人小站">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/blog/2020/12/26/Android%E4%B8%93%E6%A0%8F-WebView/" class="post-title-link" itemprop="url">Android专栏-WebView</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-26 20:37:18" itemprop="dateCreated datePublished" datetime="2020-12-26T20:37:18+08:00">2020-12-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-12-08 01:31:32" itemprop="dateModified" datetime="2021-12-08T01:31:32+08:00">2021-12-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Android专栏-WebView"><a href="#Android专栏-WebView" class="headerlink" title="Android专栏-WebView"></a>Android专栏-WebView</h2><h3 id="0x00-常规WebViewActivity"><a href="#0x00-常规WebViewActivity" class="headerlink" title="0x00 常规WebViewActivity"></a>0x00 常规WebViewActivity</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dench.webviewlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.<span class="keyword">annotation</span>.SuppressLint</span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap</span><br><span class="line"><span class="keyword">import</span> android.net.http.SslError</span><br><span class="line"><span class="keyword">import</span> android.os.Build</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle</span><br><span class="line"><span class="keyword">import</span> android.text.TextUtils</span><br><span class="line"><span class="keyword">import</span> android.util.Log</span><br><span class="line"><span class="keyword">import</span> android.view.Gravity</span><br><span class="line"><span class="keyword">import</span> android.webkit.*</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity</span><br><span class="line"><span class="keyword">import</span> androidx.databinding.DataBindingUtil</span><br><span class="line"><span class="keyword">import</span> com.alibaba.android.arouter.facade.<span class="keyword">annotation</span>.Autowired</span><br><span class="line"><span class="keyword">import</span> com.alibaba.android.arouter.facade.<span class="keyword">annotation</span>.Route</span><br><span class="line"><span class="keyword">import</span> com.alibaba.android.arouter.launcher.ARouter</span><br><span class="line"><span class="keyword">import</span> com.dench.baselib.provider.WebViewService</span><br><span class="line"><span class="keyword">import</span> com.dench.baselib.utlis.StatusBarHelper</span><br><span class="line"><span class="keyword">import</span> com.dench.webviewlib.bridge.JsInterface</span><br><span class="line"><span class="keyword">import</span> com.dench.webviewlib.databinding.ActivityWebViewBinding</span><br><span class="line"><span class="keyword">import</span> kotlinx.android.synthetic.main.activity_web_view.*</span><br><span class="line"></span><br><span class="line"><span class="meta">@Route(path = WebViewService.activityPath)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WebViewActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">lateinit</span> <span class="keyword">var</span> title: String</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">lateinit</span> <span class="keyword">var</span> url: String</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> dataViewBinding: ActivityWebViewBinding</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">    ARouter.getInstance().inject(<span class="keyword">this</span>)</span><br><span class="line">    StatusBarHelper.fitSystemBar(<span class="keyword">this</span>, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">    dataViewBinding = DataBindingUtil.setContentView(<span class="keyword">this</span>, R.layout.activity_web_view)</span><br><span class="line"></span><br><span class="line">    initToolbar()</span><br><span class="line"></span><br><span class="line">    initWebView()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onBackPressed</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (webView.canGoBack()) &#123;</span><br><span class="line">      webView.goBack()</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">super</span>.onBackPressed()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">initToolbar</span><span class="params">()</span></span> &#123;</span><br><span class="line">    dataViewBinding.toolbar.titleTv.text = title</span><br><span class="line">    <span class="keyword">val</span> backIv = dataViewBinding.toolbar.leftIv</span><br><span class="line">    backIv.setImageResource(R.drawable.ic_close)</span><br><span class="line">    backIv.setOnClickListener &#123;<span class="comment">// 关闭</span></span><br><span class="line">      finish()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SuppressLint(<span class="meta-string">"JavascriptInterface"</span>)</span></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">initWebView</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// webView Settings</span></span><br><span class="line">    initWebViewSetting()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// init Client</span></span><br><span class="line">    initClient()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// add Javascript Interface</span></span><br><span class="line">    webView.addJavascriptInterface(JsInterface(<span class="keyword">this</span>), JsInterface.NAME)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// register Scroll Listener</span></span><br><span class="line">    registerScrollListener()</span><br><span class="line"></span><br><span class="line">    loadUrl()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// webView Settings</span></span><br><span class="line">  <span class="meta">@SuppressLint(<span class="meta-string">"SetJavaScriptEnabled"</span>)</span></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">initWebViewSetting</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//声明WebSettings子类</span></span><br><span class="line">    <span class="keyword">val</span> webSettings = webView.settings</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果访问的页面中要与Javascript交互，则webView必须设置支持Javascript</span></span><br><span class="line">    webSettings.javaScriptEnabled = <span class="literal">true</span></span><br><span class="line">    webSettings.javaScriptCanOpenWindowsAutomatically = <span class="literal">true</span> <span class="comment">//支持通过JS打开新窗口</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置自适应屏幕，两者合用</span></span><br><span class="line">    webSettings.useWideViewPort = <span class="literal">true</span> <span class="comment">//将图片调整到适合webView的大小</span></span><br><span class="line">    webSettings.loadWithOverviewMode = <span class="literal">true</span> <span class="comment">// 缩放至屏幕的大小</span></span><br><span class="line">    <span class="comment">//缩放操作</span></span><br><span class="line">    webSettings.setSupportZoom(<span class="literal">true</span>)<span class="comment">//支持缩放，默认为true。是下面那个的前提。</span></span><br><span class="line">    webSettings.builtInZoomControls = <span class="literal">true</span> <span class="comment">//设置内置的缩放控件。若为false，则该WebView不可缩放</span></span><br><span class="line">    webSettings.displayZoomControls = <span class="literal">false</span> <span class="comment">//隐藏原生的缩放控件</span></span><br><span class="line">    <span class="comment">// 缓存</span></span><br><span class="line">    webSettings.cacheMode = WebSettings.LOAD_DEFAULT <span class="comment">//webView缓存策略</span></span><br><span class="line">    webSettings.domStorageEnabled = <span class="literal">true</span></span><br><span class="line">    webSettings.databaseEnabled = <span class="literal">true</span></span><br><span class="line">    webSettings.setAppCacheEnabled(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//其他</span></span><br><span class="line">    webSettings.allowFileAccess = <span class="literal">true</span> <span class="comment">//设置可以访问文件</span></span><br><span class="line">    webSettings.loadsImagesAutomatically = <span class="literal">true</span> <span class="comment">//支持自动加载图片</span></span><br><span class="line">    webSettings.defaultTextEncodingName = <span class="string">"utf-8"</span> <span class="comment">//设置编码格式</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在安卓5.0之后，默认不允许加载http与https混合内容，需要手动设置</span></span><br><span class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">      webSettings.mixedContentMode = WebSettings.MIXED_CONTENT_ALWAYS_ALLOW</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// init Client</span></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">initClient</span><span class="params">()</span></span> &#123;</span><br><span class="line">    webView.webViewClient = <span class="keyword">object</span> : WebViewClient() &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 在网页上的所有加载都经过这个方法</span></span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        view: <span class="type">WebView</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        request: <span class="type">WebResourceRequest</span>?</span></span></span><br><span class="line"><span class="function"><span class="params">      )</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        Log.i(_tag, <span class="string">"shouldOverrideUrlLoading()"</span>)</span><br><span class="line">        request?.url?.let &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">when</span> (it.scheme) &#123;</span><br><span class="line">            <span class="string">"http"</span>, <span class="string">"https"</span> -&gt; &#123; <span class="comment">// 加载网络html</span></span><br><span class="line">              <span class="keyword">super</span>.shouldOverrideUrlLoading(view, request)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="string">"file"</span>, <span class="string">"content"</span> -&gt; &#123; <span class="comment">// 加载本地html</span></span><br><span class="line">              <span class="keyword">super</span>.shouldOverrideUrlLoading(view, request)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> -&gt; &#123; <span class="comment">// 特殊 scheme 不处理</span></span><br><span class="line">              showToast(<span class="string">"<span class="variable">$it</span>"</span>)</span><br><span class="line">              <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 加载页面的服务器出现错误时（如404）调用</span></span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onReceivedError</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        view: <span class="type">WebView</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        request: <span class="type">WebResourceRequest</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        error: <span class="type">WebResourceError</span>?</span></span></span><br><span class="line"><span class="function"><span class="params">      )</span></span> &#123;</span><br><span class="line">        Log.i(_tag, <span class="string">"onReceivedError()"</span>)</span><br><span class="line">        <span class="keyword">super</span>.onReceivedError(view, request, error)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ssl 证书错误</span></span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onReceivedSslError</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        view: <span class="type">WebView</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        handler: <span class="type">SslErrorHandler</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">        error: <span class="type">SslError</span>?</span></span></span><br><span class="line"><span class="function"><span class="params">      )</span></span> &#123;</span><br><span class="line">        Log.i(_tag, <span class="string">"onReceivedSslError()"</span>)</span><br><span class="line">        handler?.proceed()   <span class="comment">//表示等待证书响应</span></span><br><span class="line">        <span class="comment">// handler?.cancel()      //表示挂起连接，为默认方式</span></span><br><span class="line">        <span class="comment">// handler?.handleMessage(null)    //可做其他处理</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 开始载入页面调用的。我们可以设定一个loading的页面，告诉用户程序在等待网络响应</span></span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPageStarted</span><span class="params">(view: <span class="type">WebView</span>?, url: <span class="type">String</span>?, favicon: <span class="type">Bitmap</span>?)</span></span> &#123;</span><br><span class="line">        Log.i(_tag, <span class="string">"onPageStarted()"</span>)</span><br><span class="line">        Log.d(</span><br><span class="line">          _tag,</span><br><span class="line">          <span class="string">"onPageStarted() called with: view = <span class="variable">$view</span>, url = <span class="variable">$url</span>, favicon = <span class="variable">$favicon</span>"</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">super</span>.onPageStarted(view, url, favicon)</span><br><span class="line">        webViewProgress.show()</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 在页面加载结束时调用。我们可以关闭loading 条，切换程序动作</span></span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPageFinished</span><span class="params">(view: <span class="type">WebView</span>?, url: <span class="type">String</span>?)</span></span> &#123;</span><br><span class="line">        Log.i(_tag, <span class="string">"onPageFinished()"</span>)</span><br><span class="line">        <span class="keyword">super</span>.onPageFinished(view, url)</span><br><span class="line">        webViewProgress.hide()</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 在加载页面资源时会调用，每一个资源（比如图片）的加载都会调用一次</span></span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onLoadResource</span><span class="params">(view: <span class="type">WebView</span>?, url: <span class="type">String</span>?)</span></span> &#123;</span><br><span class="line">        Log.d(_tag, <span class="string">"onLoadResource()"</span>)</span><br><span class="line">        Log.d(_tag, <span class="string">"onLoadResource() called with: view = <span class="variable">$view</span>, url = <span class="variable">$url</span>"</span>)</span><br><span class="line">        <span class="keyword">super</span>.onLoadResource(view, url)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    webView.webChromeClient = <span class="keyword">object</span> : WebChromeClient() &#123;</span><br><span class="line">      <span class="comment">// 加载进度</span></span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onProgressChanged</span><span class="params">(view: <span class="type">WebView</span>?, newProgress: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">        webViewProgress.progress = newProgress</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Title</span></span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onReceivedTitle</span><span class="params">(view: <span class="type">WebView</span>?, title: <span class="type">String</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!TextUtils.isEmpty(title)) &#123;</span><br><span class="line">          findViewById&lt;TextView&gt;(R.id.titleTv).text = title</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 加载URL</span></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">loadUrl</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//方式1. 加载一个网页</span></span><br><span class="line">    webView.loadUrl(url)</span><br><span class="line">    <span class="comment">//        //方式2：加载apk包中的html页面</span></span><br><span class="line">    <span class="comment">//        webView.loadUrl("file:///android_asset/test.html")</span></span><br><span class="line">    <span class="comment">//        //方式3：加载手机本地的html页面</span></span><br><span class="line">    <span class="comment">//        webView.loadUrl("content://com.android.htmlfileprovider/sdcard/test.html")</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 注册监听</span></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">registerScrollListener</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) &#123;</span></span><br><span class="line">    <span class="comment">//            webView.setOnScrollChangeListener &#123; _, _, scrollY, _, oldScrollY -&gt;</span></span><br><span class="line">    <span class="comment">//                Log.d(_tag, "scrollY: $scrollY, oldScrollY: $oldScrollY")</span></span><br><span class="line">    <span class="comment">//            &#125;</span></span><br><span class="line">    <span class="comment">//        &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">val</span> _tag = <span class="string">"WebViewActivity"</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">showToast</span><span class="params">(info: <span class="type">String</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> toast = Toast.makeText(<span class="keyword">this</span>, info, Toast.LENGTH_SHORT)</span><br><span class="line">    toast.setGravity(Gravity.CENTER_VERTICAL, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    toast.show()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="0x01-白屏问题"><a href="#0x01-白屏问题" class="headerlink" title="0x01 白屏问题"></a>0x01 白屏问题</h3><p>情景一：如果访问的页面中要与Javascript交互，则webView必须设置支持Javascript</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> webSettings = webView.settings</span><br><span class="line"><span class="comment">//如果访问的页面中要与Javascript交互，则webView必须设置支持Javascript</span></span><br><span class="line">webSettings.javaScriptEnabled = <span class="literal">true</span></span><br><span class="line">webSettings.javaScriptCanOpenWindowsAutomatically = <span class="literal">true</span> <span class="comment">//支持通过JS打开新窗口</span></span><br></pre></td></tr></table></figure>

<p>情景二：在安卓5.0之后，默认不允许加载http与https混合内容，需要手动设置</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在安卓5.0之后，默认不允许加载http与https混合内容，需要手动设置</span></span><br><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">  webSettings.mixedContentMode = WebSettings.MIXED_CONTENT_ALWAYS_ALLOW</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其他情景： 设置<code>domStorageEnabled</code> 和背景色需要验证，暂时没遇到。</p>
<h3 id="0x02-卡顿问题"><a href="#0x02-卡顿问题" class="headerlink" title="0x02 卡顿问题"></a>0x02 卡顿问题</h3><p>由于设置了 <code>android:layerType=&quot;software&quot;</code>导致的 webview 卡顿。</p>
<p>关于三个layerType属性介绍：<a href="https://blog.csdn.net/a345017062/article/details/7478667" target="_blank" rel="noopener">https://blog.csdn.net/a345017062/article/details/7478667</a></p>
<p>解决：</p>
<p>开启 Activity 硬件加速 ``android:hardwareAccelerated=”true”<code>, 并且设置 webview 的</code>android:layerType=”none”`。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/page/4/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/blog/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/11/">11</a><a class="extend next" rel="next" href="/blog/page/6/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Dench"
      src="/blog/images/avatar.png">
  <p class="site-author-name" itemprop="name">Dench</p>
  <div class="site-description" itemprop="description">Love & Peace</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">61</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">DenchOpen</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="/blog/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/pisces.js"></script>


<script src="/blog/js/next-boot.js"></script>




  















  

  

</body>
</html>
